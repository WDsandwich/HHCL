//æˆ°é¬¥æ¨¡å¼
StillInBattle
{	
	if BattleMode>=20 ; "\![raise,OnTutorial.Battle,%(BattleMode)]"
	else
	{
		case BattleMode
		{
			when 1 ; BattleMapChoose_Line
			when 2 ; BattleWarning
			when 3 ; EnemyHPCheck
			when 4 ; NextWave
			when 5 ; MissionComplete_MSG
			when 10 ; BattleMapChoose_Line
		}
	}
}

map_name_zh { ("è¾›è¿ªåŠ ","å¯¦é©—å®¤å»¢å¢Ÿ","éŠ¹æ²³-ä¹¾æ¯æ²³é“","å…§æµ·","ç„¡èƒŒæ™¯") }
map_name_en { ("Syndicate","ParmaRuins","RustRiver","DisSea","none") }
enemy_action_list { ("hecate","hella","aoe","skill","idle") }
enemy_attacktarget_list { ("èµ«å¡è’‚","æµ·æ‹‰","ç¦é–‰è€…å€‘","æŠ€èƒ½","å¾…æ©Ÿ") }

//=====é¸æ“‡æˆ°é¬¥åœ°åœ–=====
BattleModeChoose
{
	"\0\b[2]é¸æ“‡æˆ°é¬¥æ¨¡å¼ï¼ˆé–‹ç™¼ç”¨ï¼‰ï¼š\n[150]/
	\q[%(bp) åˆæ¬¡æˆ°é¬¥æµç¨‹ ,GoFristBattle]\n[130]\q[%(bp) ä¸€èˆ¬æˆ°é¬¥(åœ°åœ–é¸æ“‡) ,BattleMapChoose]"
}
BattleMapChoose_Line
{
	"\c"
	--
	click_sound=1
	if MenuChoice==0 && MoodStage(mood[0])=="G"
		"\0æˆ‘ç¾åœ¨çš„ç‹€æ…‹ï¼Œ\w8æ²’è¾¦æ³•æˆ°é¬¥â€¦â€¦\w9\n[130]å°ä¸èµ·ï¼Œ\w5%(usernameHC)ã€‚\e"
	elseif MenuChoice==0 && MoodStage(mood[1])=="G"
		"\0\s[1]æµ·æ‹‰çš„æƒ…ç·’å¥½åƒå¾ˆä½è½çš„æ¨£å­ï¼Œ\w8é‚„æ˜¯ç­‰æœƒå…’å†å»å§ã€‚\e"
	elseif MenuChoice==1 && MoodStage(mood[1])=="G" ; "\1\s[31]ä¸è¦â€¦â€¦\w4æˆ‘ä¸æƒ³å»â€¦â€¦\e"
	elseif MenuChoice==1 && MoodStage(mood[0])=="G"
		"\1\s[36]èµ«å¡è’‚çœ‹èµ·ä¾†å¾ˆé›£å—ï¼Œ\w8æˆ–è¨±æš«æ™‚ä¸è¦å»æˆ°é¬¥æ¯”è¼ƒå¥½å§ï¼Ÿ\e"
	else
	{
		case MenuChoice
		{
			when 0
			{	if BattleMode>=10
					"\0æ¥è‘—å»å“ªè£¡ï¼Ÿ"
				else
				{ case MoodStage(mood[0])
				  {
					when "A" ; "\0æˆ‘ç­‰ä¸åŠäº†ï¼Œ%(usernameHC)ã€‚"
					when "B" ; "\0å—¯ï¼Œæˆ‘ç¾åœ¨ç‹€æ…‹æ­£ä½³ã€‚"
					when "C" ; "\0è¦å»å“ªè£¡æˆ°é¬¥å‘¢ï¼Ÿ"
					when "D" ; "\0è¦å»å“ªè£¡åŸ·è¡Œä»»å‹™ï¼Ÿ"
					when "E" ; "\0æ²’é—œä¿‚ï¼Œæˆ‘é‚„æ’å¾—ä½ã€‚"
					when "F" ; "\0å¦‚æœæ˜¯%(usernameHC)çš„å‘½ä»¤çš„è©±â€¦â€¦"
				  }
				}
			}
			
			when 1
			{	if BattleMode>=10
					"\1\s[32]æˆ‘é‚„èƒ½æ‰“ï¼"
				else
				{ case MoodStage(mood[1])
				  {
					when "A" ; "\1\s[34]èµ°å§ï¼çµ¦ä»–å€‘å¥½çœ‹ï¼"
					when "B" ; "\1\s[34]æˆ‘æ­£åœ¨èˆˆé ­ä¸Šå‘¢ï¼"
					when "C" ; "\1\s[18]å¥½æ¬¸ï¼ï¼æ‰“æ¶å›‰ï¼ï¼"
					when "D" ; "\1é€™æ¬¡å»å“ªè£¡å‘€ï¼Ÿ"
					when "E" ; "\1\s[36]å¥½å§ï¼Œé›–ç„¶ç¾åœ¨ä¸å¤ªæƒ³å»â€¦â€¦"
					when "F" ; "\1\s[19]éå»ä¸å¯å—ï¼Ÿ"
				  }
				}
			}
		}
		--
		BattleMapChoose
	}
}
BattleMapChoose
{
	"\p[4]\s[-1]\b[2]%(click)\_b[img\battle\DisCity.png,2,28,--option=background,--option=use_self_alpha]/
	\![quicksession,true]\f[shadowcolor,none]\f[height,12]\f[color,#73ABAB]é«”ã€€åŠ›ï¼š\f[color,default] \f[shadowcolor,none]        %(stamina) / %(staminamax)%ProgressBar(6,50,135,stamina,staminamax)\f[shadowcolor,default]\f[height,15]"
	--
	if level>=10 ; "\_b[img\battle\dot.png,133,109,--option=use_self_alpha]\__q[OnChooseMap,2]"
	else ; "\f[color,#8E8E8E]\__q[UnlockRustRiver]"
	--
	"\_l[10,70]éŠ¹æ²³-ä¹¾æ¯æ²³é“\__q/
	\_b[img\battle\dot.png,155,159,--option=use_self_alpha]\_l[125,85]\__q[OnMapDetail,2]\_b[img\battle\skill\skill_detail,inline,--option=use_self_alpha]\__q\_l[75,119]\f[default]\__q[OnChooseMap,0] è¾›è¿ªåŠ  \__q\_l[145,134]\__q[OnMapDetail,0]\_b[img\battle\skill\skill_detail,inline,--option=use_self_alpha]\__q"
	--
	//"\_b[img\battle\dot.png,195,273,--option=use_self_alpha]\f[color,#8E8E8E]\f[shadowcolor,none]\__q"
	--
	if verson_code>=999999 ; "\__q[OnChooseMap,3]"
	else ; "\f[color,#8E8E8E]\__q[UnlockDisSea]"
	--
	"\_l[134,190]å…§æµ·\__q"
	--
	if level>=5
		"\_b[img\battle\dot.png,140,66,--option=use_self_alpha]\f[default]\__q[OnChooseMap,1]"
	else
		"\f[color,#8E8E8E]\__q[UnlockParmaRuins]"
	--
	"\_l[40,30]å¯¦é©—å®¤å»¢å¢Ÿ\__q\_l[130,45]\__q[OnMapDetail,1]\_b[img\battle\skill\skill_detail,inline,--option=use_self_alpha]\__q"
	--
	batlle_level = TOINT(batlle_level)
	if batlle_level<0 ; batlle_level=0
	"\_l[10,180]\f[height,12]\f[color,#CA8EC2]æ±™æŸ“å±¤ç´šï¼š\n[120]\_l[15]\__q[OnBattle.ChangeBL,-1]%QTYimg('-')\__q \__q[OnBattle.ChangeBL,input]%(batlle_level)\__q \__q[OnBattle.ChangeBL,1]%QTYimg('+')\__q\n"
	--
	"\_l[5,225]\f[color,#FFD700]\f[height,12]\q[<è¿”å›ç®¡ç†å±€,Battle.Cancel]"
}
OnBattle.ChangeBL
{
	if reference0=="input"
	{	BattleMapChoose
		--
		"\![open,inputbox,OnBattle.ChangeBL.Enter,-1,--text=%(batlle_level)]"
	}
	else
	{	batlle_level+=reference0 ; BattleMapChoose	}
}
OnBattle.ChangeBL.Enter
{	_bl=reference0
	if GETTYPE(_bl)==1 || GETTYPE(_bl)==2 ; batlle_level=TOINT(_bl)
	BattleMapChoose
}
Battle.Cancel
{
	if BattleMode>=1 && MenuChoice==0
	{	"\0\s[0]%(usernameHC)é‚„æ˜¯æ‰“ç®—ä¼‘æ¯ä¸€ä¸‹å—ï¼Ÿ"	}
	elseif BattleMode>=1 && MenuChoice==1
	{	"\1\s[13]æ¬¸ï¼ï¼\w5å¤±æœ›â€¦â€¦"	}
	elseif BattleMode==0 && MenuChoice==0 && MoodStage(mood[0])=="E"
	{	"\0\s[1]æŠ±æ­‰ï¼Œ\w4æˆ‘å†å»èª¿æ•´ä¸€ä¸‹ã€‚"}
	elseif BattleMode==0 && MenuChoice==0 && MoodStage(mood[0])=="F"
	{	"\0\s[5]è¬è¬â€¦â€¦"}
	elseif BattleMode==0 && MenuChoice==0
	{	"\0é‚„æœ‰ä»€éº¼è¦æº–å‚™çš„å—ï¼Ÿ" ; "\0æˆ‘éš¨æ™‚éƒ½ç‚º%(usernameHC)å¾…å‘½ã€‚"}
	elseif BattleMode==0 && MenuChoice==1 && MoodStage(mood[1])=="E"
	{	"\1\s[13]æˆ‘æƒ³å›å®¶â€¦â€¦"	}
	elseif BattleMode==0 && MenuChoice==1 && MoodStage(mood[1])=="F"
	{	"\1\s[13]å¤ªå¥½äº†â€¦â€¦"	}
	elseif BattleMode==0 && MenuChoice==1
	{	"\1\s[16]æ¬¸ï¼ï¼ï¼ï¼" ; "\1\s[13]æ²’æœ‰è¦æ‰“æ¶äº†å—ï¼Ÿ"}
	--
	BattleMode=0
	--
	"\e"
}
OnMapDetail
{
	_name="è¾›è¿ªåŠ ,å¯¦é©—å®¤å»¢å¢Ÿ,éŠ¹æ²³-ä¹¾æ¯æ²³é“"
	_detail="æš´åŠ›çš„æº«åºŠï¼Œé»‘å¹«çš„èˆå°ã€‚å¶çˆ¾ä¹Ÿæœ‰æ­»å½¹åœ¨æ­¤å‡ºæ²’ã€‚,éºç•™åœ¨æ­¤çš„å¯¦é©—é«”å’Œå™¨æï¼Œå—ç‹‚å„å½±éŸ¿å¾Œï¼Œèª•ç”Ÿå‡ºç¨ç‰¹çš„åŸç”Ÿç¨®ã€‚,åŸæœ¬æµæ·Œè‘—æ²³æ°´çš„åœ°æ–¹åªå‰©ä¸‹é«˜åº¦æ±¡æŸ“çš„æ³¥æ¿˜ï¼Œæºæºä¸çµ•çš„æ­»å½¹å¤§é‡å‡ºæ²’ã€‚"
	_level=(1,5,10)
	_info="- æ“Šæ•—æ•µäººæ™‚å¯ç²å¾—ç‹„æ–¯å¹£ï¼Œæ•¸ç›®éš¨ç­‰ç´šå¢åŠ \n[130]- ç„¡æ³•åœ¨æ­¤ç²å¾—æŸ“åŠ‘åŸç¤¦,- æ•µäººæ“æœ‰æ›´é«˜çš„è¡€é‡\n[130]- æ‰è½çš„æŸ“åŠ‘åŸç¤¦å’Œå¼·åŒ–é“å…·ç‚º2å€,- æ•µäººæ“æœ‰è¼ƒé«˜çš„è¡€é‡èˆ‡æ›´é«˜çš„æ”»æ“ŠåŠ›ï¼Œä»¥åŠæ›´å¤šæ¨£çš„æ”»æ“Šæ–¹å¼\n[130]- æ“Šæ•—æ•µäººæ™‚å°‡ç²å¾—æ›´å¤šç¶“é©—å€¼"
	_pay=("éš¨ç­‰ç´š&æ±™æŸ“å±¤ç´šå¢åŠ ",3000,5000)
	_wave=(7,5,10,3)
	_sta=(2,4,3,5)
	_n=reference0
	"\p[6]\s[-1]\b[2]\![quicksession,true]%(click)\![*]\f[color,#E0FFFF]\f[bold,1]%(_name[_n])\![*]\n[10]\f[align,right]\f[height,12]\f[color,default]Lv.\f[color,#80FFFF]%(_level[_n])\f[color,default]è§£é–\f[default]\n[130]\f[align,left]/
	\f[height,12]\f[color,#9D9D9D]%(_detail[_n])\f[default]\n[150]%(_info[_n])\n[200]/
	\f[color,#E87DB3]ç¸½waveæ•¸ï¼š%(_wave[_n])\n[130]/
	\f[color,#80FFFF]å–®waveæ¶ˆè€—é«”åŠ›ï¼š%(_sta[_n])\n[130]/
	\f[color,#FFDC35]é€šé—œå ±é…¬ï¼š%(_pay[_n])/
	\f[color,150,150,150]\f[height,12]\_l[150,220]\_b[img/CancelIcon,inline]\q[é—œé–‰,BattleMapChoose]"
	--
	BattleMapChoose
}
UnlockParmaRuins
{
	BattleMapChoose
}
UnlockRustRiver
{
	BattleMapChoose
}
UnlockDisSea
{
	BattleMapChoose
}
BalloonTooltip_UnlockParmaRuins { "ç­‰ç´š5ä»¥ä¸Š è§£é–" }
BalloonTooltip_UnlockRustRiver { "ç­‰ç´š10ä»¥ä¸Š è§£é–" }
BalloonTooltip_UnlockDisSea { "å°šæœªé–‹æ”¾" }

OnChooseMap
{
	BattleMode=1
	map_num=reference0
	mapname=map_name_en[map_num]
	case mapname
	{
		when "Syndicate"
		{
			missionpay=50+level*27+TOINT(level*batlle_level*1.14514)
			wave=(1,7,2)
		}
		when "ParmaRuins"
		{
			missionpay=3000
			wave=(1,5,4)
		}
		when "RustRiver"
		{
			missionpay=5000
			wave=(1,10,3)
			if developermode==1
			"\![sound,loop,sound/bgm/awesomeness.mp3]\![sound,option,sound/bgm/awesomeness.mp3,--volume=70]"
		}
		when "DisSea"
		{
			missionpay=10000
			wave=(1,3,5)
		}
	}
	--
	"\p[6]\s[-1]\![set,balloonalign,right]\![move,--X=550,--Y=440,--time=10,--base-offset=left.top]\p[5]\s[-1]\![bind,background,%(mapname),1]\![set,balloonalign,top]\![move,--X=500,--Y=400,--time=10,--base-offset=left.top]"
	--
	AllMapSetting
}

//è¾›è¿ªåŠ  åœ°åœ–è¨­å®š
ChooseMap_Syndicate
{
	BattleMode=1
	mapname="Syndicate"
	missionpay=50+level*27+TOINT(level*batlle_level*1.14514)
	wave=(1,7,2)
	--
	"\p[6]\s[-1]\![bind,background,Syndicate,1]\![set,balloonalign,right]\![move,--X=550,--Y=440,--time=10,--base-offset=left.top]\p[5]\s[-1]\![bind,background,Syndicate,1]\![set,balloonalign,top]\![move,--X=500,--Y=400,--time=10,--base-offset=left.top]"
	--
	AllMapSetting
}
//å¯¦é©—å®¤å»¢å¢Ÿ åœ°åœ–è¨­å®š
ChooseMap_ParmaRuins
{
	BattleMode=1
	mapname="ParmaRuins"
	missionpay=3000
	wave=(1,5,4)
	--
	"\p[5]\s[-1]\![bind,background,ParmaRuins,1]"
	--
	AllMapSetting
}
//éŠ¹æ²³æ²³é“ åœ°åœ–è¨­å®š
ChooseMap_RustRiver
{
	BattleMode=1
	mapname="RustRiver"
	missionpay=2000
	wave=(1,10,6)
	--
	"\p[5]\s[-1]\![bind,background,RustRiver,1]"
	--
	AllMapSetting
}
//å…§æµ· åœ°åœ–è¨­å®š
ChooseMap_DisSea
{
	BattleMode=1
	mapname=DisSea
	missionpay=5000
	wave=(1,3)
	"\p[5]\s[-1]\![bind,background,DisSea,1]"
	AllMapSetting
}

//é€šç”¨é–‹å ´è¨­å®š
AllMapSetting
{
	if	   MoodStage(mood[0])=="E" ; mood[0]-=10
	elseif MoodStage(mood[0])=="F" ; mood[0]-=20
	if 	   MoodStage(mood[1])=="E" ; mood[1]-=10
	elseif MoodStage(mood[1])=="F" ; mood[1]-=20
	roundNum=1
	InitialSetting
	Edrop=(0,0,0,0,0,0,,,0)
	Edmg=(0,0,0)
	debuff_HC=(0,0,0)
	debuff_HL=(0,0,0)
	evasion=(15,15)
	cirt=(15,15)
	pressbutton=0
	click_sound=1
	enemy_nameSetting
	EnemyInfoSetting
	--
	"\c%BattleSurface('none')\![set,choicetimeout,0]\![set,balloonalign,left]\f[align,center]"
	--
	"\b[10]\n[130]%SFX('battle/01-HC-46-go ba')æˆ‘å€‘èµ°å§ï¼Œ%(usernameHC)ã€‚"
	"\b[12]\n[130]%SFX('battle/HL-levelstrat-GOGOGO')å‡ºç™¼ï¼"
	--
	"\w9\w9"
	--
	BattleWarning
}

//é€šç”¨åˆå§‹è¨­å®š
InitialSetting
{
	//Bmp=èµ«å¡è’‚,æµ·æ‹‰,å±€é•·,ç¦é–‰è€…ä¸Šé™,å±€é•·ä¸Šé™
	Bmp=(1,1,3,3,7)
	HCskill=(0,0)
	HLskill=(0,0,0)
	OrderDone=(0,0,0)
	ordertarget=1
	def=(1,1)
	incapacitated=(0,0)
	--
	if level==1
		{HCinc=(500,317)
		HLinc=(1000,222)
		Einc_C=(200,20)}
	elseif level>1
		{HCinc_b=(500+(level-1)*10,317+(level-1)*3+TOINT(ROUND((level-1)/7*5)))
		HLinc_b=(TOINT(HCinc_b[0]*1.3),TOINT(HCinc_b[1]*0.7))
		HCinc=(HCinc_b[0]+HCinc_ex[0],HCinc_b[1]+HCinc_ex[1])
		HLinc=(HLinc_b[0]+HLinc_ex[0],HLinc_b[1]+HLinc_ex[1])
		Einc_B_b=(500+level*14+(level-1)*22,100+(level-1)*3)
		Einc_C=((200+(level)*14)*1.5+RAND(level),20+(level-1)*25+RAND(level))}
	elseif level>=100
		{HCinc_b=(50000,18703)
		HLinc_b=(HCinc_b[0]*2,HCinc_b[1]*0.7)
		HCinc=(HCinc_b[0]+HCinc_ex[0],HCinc_b[1]+HCinc_ex[1])
		HLinc=(HLinc_b[0]+HLinc_ex[0],HLinc_b[1]+HLinc_ex[1])
		Einc_B_b=(328586,14950)
		Einc_C=(54650,14870)}
	--
	HCinc[1]=TOINT(HCinc[1]*mood[0]*0.001)
	HLinc[1]=TOINT(HLinc[1]*mood[1]*0.001)
	hp=(HCinc[0],HLinc[0])
}

//=====æˆ°é¬¥æµç¨‹=====
//æ•µäººåç¨±è¨­å®š
enemy_nameSetting
{
	case mapname
	{
	  when "Syndicate"
		enemy_name=ANY(EnemyC)
	  when "ParmaRuins"
	  {
		_Eappear=RAND(20)
		--
		if _Eappear==1
			enemy_name="ï¼Ÿï¼Ÿï¼Ÿ"
		else
			enemy_name=ANY(EnemyP)
		--
		if wave[0]==1
			enemy_name=ANY(EnemyP)
	  }
	  when "RustRiver"
	  {
			enemy_name=ANY(EnemyR)
	  }
	}
}
//==================================================
//-------------------ä¸»è¦æˆ°é¬¥è¦–çª—-------------------
//==================================================
BattleWarning
{
	if wave[0]>wave[1]
		MissionComplete
	elseif OrderDone[0]*OrderDone[1]==1 && OrderDone[2]==0
		Enemy.Act
	else
	{
		BattleMode=2
		enemy_action="idle"
		--
		"\0\s[-1]\1\s[-1]\p[2]%cp(0)\p[5]\s[520010]"
		--
		if roundNum==1 && OrderDone[0]+OrderDone[1]==0 && pressbutton==0
		{	"\![bind,enemy,%(enemy_name)-entrance,1]\_w[120]"	}
		--
		"\![bind,enemy,%(enemy_name)-idle,1]"
		--
		"\p[6]\s[-1]\b[32]\c%(click)\![set,choicetimeout,0]"
		--
		if roundNum==1
		{	"%(bp) å‰æ–¹é­é‡ %(enemy_name) ï¼%(bp)"
			"%(bp) %(enemy_name) è¿é¢èµ°ä¾†ï¼%(bp)"
			"%(bp) é‡è¦‹äº† %(enemy_name) ï¼%(bp)"
		}
		elseif enemy_name=="ï¼Ÿï¼Ÿï¼Ÿ"
		{	case roundNum
			{	when 2 ; "%(bp) å·¨å¤§çš„é›™å”‡ä¸€å¼µä¸€åˆâ€¦â€¦ %(bp)"
				when 3-6 ; "%(bp) ç¥‚ä¼¼ä¹æƒ³å‚³é”äº›ä»€éº¼â€¦â€¦ %(bp)"
				when 7 ; "%(bp) èµ«å¡è’‚å°‡ç„¡æ³•è§£è®€çš„è¨Šæ¯è¨˜éŒ„äº†ä¸‹ä¾†â€¦â€¦ %(bp)"
				when 8-999
				{	"%(bp) ç©ºæ´çš„çœ¼ç¥æ³¨è¦–è‘—å‰æ–¹â€¦â€¦ %(bp)"
					"%(bp) %(you)çš„è…¦è¢‹ä¸€é™£æšˆçœ©â€¦â€¦ %(bp)"	}
			}	
		}
		elseif enemy_action=="idle"
		{	case enemy_name
			{	when "æ†‚é¬±çš„å©¦äºº" ; "%(bp) ç„¡æ³•çœ‹æ¸…å¥¹çš„è‡‰â€¦â€¦ %(bp)"
				when "é­Ÿé­š" ; "%(bp) %(enemy_name) å¥½åƒå¾ˆé–‹å¿ƒçš„æ¨£å­â€¦â€¦ %(bp)"
			}
		}
		else
		{
			{"%(bp) %(enemy_name) è™è¦–çœˆçœˆåœ°çœ‹è‘—%(AttackTarget)â€¦â€¦ %(bp)"
			"%(bp) %(enemy_name) ä¼¼ä¹åœ¨å°‹æ‰¾é€²æ”»çš„æ™‚æ©Ÿâ€¦â€¦ %(bp)"}
		}
		--
		BattleInfoWindow
		--
		"\w9"
		--
		pressbutton++
		--
		BattleOrder
	}
}
//æˆ°é¬¥è³‡è¨Šè¦–çª—
BattleInfoWindow
{
	"\n\![quicksession,true]\![set,choicetimeout,0]\_l[-,50]"
	--
	DividingLine2
	--
	"\n"
	--
	//		åœ–æ¨™
	"\_b[img\battle\enemy\%(enemy_name).png,inline,--option=use_self_alpha]"
	--
	//		buffã€debuffç‹€æ…‹é¡¯ç¤ºç”¨
	_status_HC="" ; _status_HL=""
	for _i=0 ; _i<ARRAYSIZE(debuff_name) ; _i++
	{
		if debuff_HC[_i]>=1
		{	
			_status_HC+=debuff_icon[_i]
		}
	}
	for _i=0 ; _i<ARRAYSIZE(debuff_name) ; _i++
	{
		if debuff_HL[_i]>=1
		{	
			_status_HL+=debuff_icon[_i]
		}
	}
	--
	"\n[20]\_l[65]\f[height,12]"
	--
	if BattleMode==4 ; "å‰©é¤˜é«”åŠ› ï¼ˆ\f[color,#80FFFF]-%(wave[2])\f[color,default]ï¼‰"
	else ; "%(enemy_name)"
	--
	"\n[125]\_l[65]\f[shadowcolor,none]"
	--
	if BattleMode==4 ; "%(stamina)/%(staminamax)%ProgressBar(6,60,100,stamina,staminamax)\n[190]"
	else ; "%TOINT(Ehp)/%TOINT(Einc[0])%ProgressBar(1,60,100,Ehp,Einc[0])\n[190]"
	--
	DividingLine2
	--
	"\f[height,12]\n\_l[30]\f[color,#E0FFFF]å±€é•·èƒ½é‡%EnergyBar(90,Bmp[2],Bmp[4])\f[default]\n[111]"
	--
	if OrderDone[0]==1
		"\_b[img\battle\1P.jpg,inline,--option=use_self_alpha]"
	else
		"\__q[OnChangeOrder,0]\_b[img\battle\1P.jpg,inline,--option=use_self_alpha]\__q"
	--
	"\n[11]\f[height,12]\f[valign,bottom]\_l[65,160]"
	--
	if ordertarget==0
		"\f[color,#CE0000]â–¶ \f[color,default]"
	--
	"èµ«å¡è’‚\__q[OnBattleInfoWindow.Status,èµ«å¡è’‚]%(_status_HC)\__q\n[125]\_l[65,180]\f[shadowcolor,none]%(hp[0])/%(HCinc[0])%ProgressBar(1,60,100,hp[0],HCinc[0])\n%EnergyBar(60,Bmp[0],Bmp[3])\n[140]"
	--
	if OrderDone[1]==1
		"\_b[img\battle\2P.jpg,inline,--option=use_self_alpha]"
	else
		"\__q[OnChangeOrder,1]\_b[img\battle\2P.jpg,inline,--option=use_self_alpha]\__q"
	--
	"\n[11]\f[height,12]\_l[65,215]"
	--
	if ordertarget==1
		"\f[color,#CE0000]â–¶ \f[color,default]"
	--
	"æµ·æ‹‰"
	--
	if HLskill[1]>=1
		"    \f[color,#E76123]â–²%(HLskill[1])\f[color,default]"
	--
	"\__q[OnBattleInfoWindow.Status,æµ·æ‹‰]%(_status_HL)\__q\n[125]\_l[65,235]\f[shadowcolor,none]%(hp[1])/%(HLinc[0])%ProgressBar(1,60,100,hp[1],HLinc[0])\n%EnergyBar(60,Bmp[1],Bmp[3])\n[140]/
	\_l[4]\f[color,#EAC100]Lv.%(level)\f[default]%ProgressBar(3,40,120,exp,levelupexp)\n[150]"
	--
	"\f[default]\_l[5]wave %(wave[0])/%(wave[1])\n[1]\f[align,right]round %(roundNum) "
}

OnBattleInfoWindow.Status
{
	"\p[6]\s[-1]\b[32]\![quicksession,true]%(BattleInfoWindow)"
	--
	_s=""
	case reference0
	{	when "èµ«å¡è’‚" ; _s=debuff_HC
		when "æµ·æ‹‰" ; _s=debuff_HL
	}
	--
	_txt="\p[7]\s[-1]\b[36]\![quicksession,true]\![set,choicetimeout,0]\![*]%(reference0)çš„ç‹€æ…‹ \![*]\n\_l[-,18]"
	--
	for _i=0 ; _i<ARRAYSIZE(debuff_name) ; _i++
	{  if _s[_i]>=1
		_txt+="%(debuff_color[_i])%(debuff_icon[_i])%(debuff_name[_i]) \f[color,#FFD500]\f[bold,1]%(_s[_i])\f[default]å›åˆ\n\f[color,#D6F0F0]%(debuff_detail[_i])\n[125]"
	}
	--
	_txt
	--
	BattleOrder
}

OnChangeOrder
{
	ordertarget=reference0
	--
	BattleWarning
}


//==================================================
//-------------------æˆ‘æ–¹è¡Œå‹•-------------------
//==================================================
//ä¸‹é”æˆ°é¬¥æŒ‡ä»¤
BattleOrder
{
	if OrderDone[0]+OrderDone[1]==0
		OrderLine
	elseif OrderDone[0]==0
	{	ordertarget=0 ; OrderLine	}
	elseif OrderDone[1]==0
	{	ordertarget=1 ; OrderLine	}
	--
	OrderOptions
}
OrderLine
{
	"\0\s[-1]\1\s[-1]\p[2]%cp(0)\p[5]"
	--
	case ordertarget
	{
		when 0
		{
			"\b[10]\f[align,center]\![set,choicetimeout,0]\n[120]"
			--
			""
			--
			"%SFX('battle/01-HC-18-please tell me what you decide')æˆ‘è©²æ€éº¼åšï¼Ÿ"
			"%SFX('battle/02-HC-01-give me order chief')%(usernameHC)ï¼Œè«‹çµ¦æˆ‘å‘½ä»¤ã€‚"
			"%SFX('battle/01-HC-12-please order')è«‹%(usernameHC)ä¸‹é”æŒ‡ä»¤ã€‚"
		}
		when 1
		{
			"\b[12]\c\![set,choicetimeout,0]\n[120]\f[align,center]"
			--
			"%SFX('exc/01-HL-16-hihi')"
			"%SFX('exc/01-HL-12-haha')"
			"%SFX('exc/01-HL-05-he')"
			--
			"è®“è€å¨˜å¥½å¥½æ”¶æ‹¾ä»–å€‘ä¸€é “ï¼"
			"å¯åˆ¥è¢«åš‡è·‘äº†å–”ï¼Ÿ"
			"äº¤çµ¦æˆ‘å§ï¼"
			"æ”¾é¦¬éä¾†ï¼"
		}
	}
}

OrderOptions
{
	"\0\s[-1]\1\s[-1]\p[2]%cp(0)\b[24]\c\f[align,center]\![set,choicetimeout,0]\q[âš”ï¸æ”»æ“Š,OrderAttack]\n[130]/
	\q[ğŸ—²æŠ€èƒ½,OrderSkill]\n[130]/
	\q[ğŸ›¡ï¸é˜²ç¦¦,OrderDefense]\n[130]/
	\q[â—Šå±€é•·æ¬Šèƒ½,ChiefPotestas]\n[170]/
	\f[height,12]\f[color,#BEBEBE]  \q[ é€ƒè·‘ â¤,BattleRunaway]\f[default]"
}
OrderCancel
{
	_txt="\n\_l[-,"
	--
	if _argv[0]==2 ; _txt+="90"
	else ; _txt+="95"
	--
	_txt+="]\f[align,center]\f[height,12]\f[color,#BEBEBE]\q[ âœ–å–æ¶ˆ ,BattleWarning]\f[default]"
	_txt
}
//====================æ™®æ”»====================
//æŒ‡ä»¤-æ”»æ“Š
OrderAttack
{
	DecideSdmg
	--
	"\0\s[-1]\1\s[-1]\p[2]%cp(1)\p[6]\s[-1]\b[32]\c"
	--
	case ordertarget{
	  when 1
		{
			OrderDone[1]=1
			--
			"%SFX('exc/01-HL-19-hiu')%SFX('sfx/metal punch1')"
			"%SFX('exc/01-HL-19-hiu')%SFX('sfx/metal punch2')"
			"%SFX('exc/01-HL-19-hiu')%SFX('sfx/metal punch3')"
			"%SFX('exc/02-HL-28-hen')%SFX('sfx/metal punch1')"
			"%SFX('exc/02-HL-28-hen')%SFX('sfx/metal punch2')"
			"%SFX('exc/02-HL-28-hen')%SFX('sfx/metal punch3')"
			--
			"\p[5]%BattleSurface('atk')\b[-1]\p[6]\s[-1]\b[32]"
			--
			"%(bp) æµ·æ‹‰ æ¯†æ‰“äº† %(enemy_name) ï¼Œé€ æˆ %bh(Sdmg) é»å‚·å®³ï¼%(bp)"
			--
			crit_msg
			--
			//ä¸­æ¯’ä½œç”¨
			if debuff_HL[0]>=1
			{	hp[1]-=TOINT(HLinc[0]/10)
				--
				"\n\w7%(sfx_poison)%(bp) ä½†æ˜¯ï¼Œåœ¨ %(debuff_color[0])%(debuff_name[0])\f[default] çš„å½±éŸ¿ä¸‹ï¼Œæå¤±äº† %(debuff_color[0])%TOINT(HLinc[0]/10)\f[default] é»HP %(bp)"
			}
			--
			"\x"
			--
			Sinner.HPCheck
			if hp[1]>0 ; EnemyBeenAttack
		}
	  when 0
		{
			OrderDone[0]=1
			--
			"\p[5]%BattleSurface('atk')"
			--
			"%SFX('sfx/Panchi no suburi 1')"
			"%SFX('sfx/Panchi no suburi 2')"
			"%SFX('sfx/Panchi no suburi 3')"
			"%SFX('sfx/ Kikku no suburi 1')"
			"%SFX('sfx/ Kikku no suburi 2')"
			"%SFX('sfx/ Kikku no suburi 3')"
			--
			"\p[6]\s[-1]\b[32]%(bp) èµ«å¡è’‚ æ”»æ“Šäº† %(enemy_name) ï¼Œé€ æˆ %bh(Sdmg) é»å‚·å®³ï¼%(bp)"
			--
			crit_msg
			--
			//ä¸­æ¯’ä½œç”¨
			if debuff_HC[0]>=1
			{	hp[0]-=TOINT(HCinc[0]/10)
				--
				"\n\w7%(sfx_poison)%(bp) ä½†æ˜¯ï¼Œåœ¨ %(debuff_color[0])%(debuff_name[0])\f[default] çš„å½±éŸ¿ä¸‹ï¼Œæå¤±äº† %(debuff_color[0])%TOINT(HCinc[0]/10)\f[default] é»HP %(bp)"
			}
			--
			"\x"
			--
			Sinner.HPCheck
			if hp[0]>0 ; EnemyBeenAttack
		}
	}
}


//====================ç¦é–‰è€…æŠ€èƒ½====================
//æŒ‡ä»¤-æŠ€èƒ½
OrderSkill
{
	skill_name="ç„¡å…‰ä¹‹é¡,å¬å–šå¤¢é­˜"
	skill_usemp=(1,2)
	skill_level=(5,15)
	skill_cold=(1,5)
	skill_detail="å°æ•µæ–¹é€ æˆèµ«å¡è’‚æ”»æ“ŠåŠ›2.5å€çš„å‚·å®³ã€‚,ç‚ºæˆ‘æ–¹æŠµæ“‹è©²å›åˆæ‰€æœ‰å‚·å®³å’Œç•°å¸¸ç‹€æ…‹é™„åŠ ã€‚"
	if ordertarget==1
	{
		skill_name="æ–‡æ˜è¿ªæ–¯,æ­¦åŠ›å…¨é–‹,å¥®åŠ›ä¸€æ“Š"
		skill_usemp=(1,2,3)
		skill_level=(2,10,20)
		skill_cold=(1,5,2)
		skill_detail="å¼·è¿«æ•µæ–¹çš„å–®é«”æ”»æ“Šå°è±¡è½‰ç‚ºæµ·æ‹‰ï¼Œç„¡æ³•æ”¹è®Šå…¨é«”æ”»æ“Šã€‚,ä½¿æµ·æ‹‰çš„æ”»æ“ŠåŠ›æå‡5å›åˆï¼Œæ­¤æœŸé–“ç„¡æ³•è‡ªå‹•å›å¾©èƒ½é‡ã€‚,å°æ•µæ–¹é€ æˆæµ·æ‹‰æ”»æ“ŠåŠ›5å€çš„å‚·å®³ã€‚"
	}
	
	case ordertarget
	{
	  when 1
	  {
		if debuff_HL[3]>=1 && enemy_name=="å©•å…‹å—ç“œ"
		{
			"\0\s[-1]\1\s[-1]\p[2]%cp(2)\p[6]\c\s[-1]\b[32]%SFX('sfx/Bipu-on 3')%(bp) æµ·æ‹‰å—åˆ° %(enemy_name) çš„ è©­è¨ˆ èª˜é¨™ï¼Œæ‹’çµ•ä½¿ç”¨æŠ€èƒ½ %(bp)"
			--
			"\x"
			--
			"\c"
			--
			BattleWarning
		}
		elseif Bmp[1]==0
		{
			"\0\s[-1]\1\s[-1]\p[2]%cp(3)\p[6]\c\s[-1]\b[32]%SFX('sfx/Bipu-on 3')%(bp) æµ·æ‹‰çš„èƒ½é‡ä¸è¶³ï¼Œç„¡æ³•ä½¿ç”¨æŠ€èƒ½ï¼%(bp)"
			--
			"\x"
			--
			"\c"
			--
			BattleWarning
		}
		elseif Bmp[1]>=1
		{	"\p[2]\b[24]\c\s[-1]\f[align,center]\![set,choicetimeout,0]\![quicksession,true]"
			--
			OpenSkillOption
		}
	  }
	  when 0
	  {
		if debuff_HC[3]>=1 && enemy_name=="å©•å…‹å—ç“œ"
		{
			"\0\s[-1]\1\s[-1]\p[2]%cp(2)\p[6]\c\s[-1]\b[32]%SFX('sfx/Bipu-on 3')%(bp) èµ«å¡è’‚å—åˆ° %(enemy_name) çš„ è©­è¨ˆ èª˜é¨™ï¼Œæ‹’çµ•ä½¿ç”¨æŠ€èƒ½ %(bp)"
			--
			"\x"
			--
			"\c"
			--
			BattleWarning
		}
		elseif Bmp[0]==0
		{
			"\0\s[-1]\1\s[-1]\p[2]%cp(3)\p[6]\c\s[-1]\b[32]%SFX('sfx/Bipu-on 3')%(bp) èµ«å¡è’‚çš„èƒ½é‡ä¸è¶³ï¼Œç„¡æ³•ä½¿ç”¨æŠ€èƒ½ï¼%(bp)"
			--
			"\x"
			--
			"\c"
			--
			BattleWarning
		}
		elseif Bmp[0]>=1
		{
			"\p[2]\b[24]\c\f[align,center]"
			--
			OpenSkillOption
			/*if level>=70
				"]\q[å™©å¤¢è©›å’’,CastSkillHC2]"
			else
				"\f[color,#BEBEBE]å™©å¤¢è©›å’’"
			--*/
		}
	  }
	}
}
OpenSkillOption
{
	battle_msg = "ï¼ˆé¸æ“‡æŒ‡ä»¤æŠ€èƒ½â€¦â€¦ï¼‰"
	SkillOption
}
SkillOption
{
	_txt="\p[2]%cp(0)\b[22]\f[align,center]\![quicksession,true]%(click)"
	for _i=0 ; _i<ARRAYSIZE(skill_name) ; _i++
	{
		if level>=skill_level[_i]
		_txt+="\__q[OnCastSkill,%(_i)]\_b[img\battle\skill\%(Char_Code[ordertarget])%(_i).png,inline,--option=use_self_alpha] %(skill_name[_i])(%(skill_usemp[_i]))\__q \__q[OnSkillDetail,%(_i)]\_b[img\battle\skill\skill_detail.png,inline,--option=use_self_alpha]\__q\n[180]"
	}
	_txt+= OrderCancel(2)
	_txt+="\p[6]\s[-1]\b[32]%(battle_msg)"
	click_sound = 1
	_txt+= BattleInfoWindow
	_txt
}
BalloonTooltip_OnSkillDetail { "æŸ¥çœ‹æŠ€èƒ½è©³æƒ…" }
OnSkillDetail
{
	_skill=reference0
	click_sound = 0
	battle_msg = "ã€\f[color,#FFD306]\f[bold,1]%(skill_name[_skill])\f[default]ã€‘  æ¶ˆè€—\f[color,#A6FFFF]\f[bold,1]%(skill_usemp[_skill])\f[default]èƒ½é‡\n%(skill_detail[_skill])"
	if skill_cold[_skill]>1 && skill_name[_skill]!="æ­¦åŠ›å…¨é–‹"
		battle_msg += "ï¼ˆå†·å»%(skill_cold[_skill])å›åˆï¼‰"
	SkillOption
}
//æ–½æ”¾æŠ€èƒ½
OnCastSkill
{
	_skill=reference0
	OrderDone[ordertarget]=1
	if	   ordertarget==0 ; HCskill[_skill]+=skill_cold[_skill]
	elseif ordertarget==1 ; HLskill[_skill]+=skill_cold[_skill]
	_debuff=debuff_HC ; _posionedhp=TOINT(HCinc[0]*0.1)
	if ordertarget==1
	{ _debuff=debuff_HL ; _posionedhp=TOINT(HLinc[0]*0.1) }
	_atkmode=0
	DecideSdmg
	--
	//é¡¯ç¤ºè¨Šæ¯
	if Bmp[ordertarget]<skill_usemp[_skill]
	{
		"\p[2]%cp(3)\p[6]\s[-1]\b[32]\c\![set,choicetimeout,0]%(bp)%(Char_Name[ordertarget])çš„èƒ½é‡ä¸è¶³%(skill_usemp[_skill])é»ã€‚%(bp)"
		--
		"\x"
		--
		OpenSkillOption
	}
	else
	{
		Bmp[ordertarget]-=skill_usemp[_skill]
		"\p[2]%cp(1)"
		--
		if ordertarget==0 && _skill==0
		{
			_atkmode=1
			"\p[5]%BattleSurface('skill')\p[6]\s[-1]\b[32]\c\![set,choicetimeout,0]"
			--
			"%SFX('skill/01-HC-54-dreamshadow')"
			"%SFX('skill/02-HC-27-dreamshadow')"
			"%SFX('skill/02-HC-29-dreamshadow')"
			"%SFX('skill/02-HC-57-nightmare')"
			"%SFX('skill/01-HC-55-defeat them')"
			--
			"%SFX('sfx/Menyu o hiraku 2')"
			--
			"%(bp) èµ«å¡è’‚ æ–½å±• ç„¡å…‰ä¹‹é¡ å° %(enemy_name) é€ æˆ %bh(TOINT(Sdmg)) é»å‚·å®³ï¼%(bp)"
			"%(bp) èµ«å¡è’‚ è§£æ”¾å¤¢é­˜çš„åŠ›é‡å° %(enemy_name) æ”»æ“Šï¼Œé€ æˆ %bh(TOINT(Sdmg)) é»å‚·å®³ï¼%(bp)"
			--
			crit_msg
		}
		elseif ordertarget==0 && _skill==1
		{
			if HCskill[1]==5
				"\p[2]%cp(1)\p[6]\s[-1]\b[32]%SFX('sfx/gravity magic1')%(bp) èµ«å¡è’‚çš„å¤¢é­˜å°‡ç‚ºæˆ‘æ–¹ç¦é–‰è€…æŠµç¦¦æœ¬å›åˆçš„æ‰€æœ‰å‚·å®³ã€‚%(bp)"
			else
			{	OrderDone[0]=0
				HCskill[1]-=5
				Bmp[0]+=2
				"\p[2]%cp(3)\p[6]\s[-1]\b[32]%SFX('sfx/Bipu-on 3')%(bp)æŠ€èƒ½å†·å»ä¸­ï¼Œå°šæœ‰%(HCskill[1])å›åˆã€‚%(bp)"
			}
		}
		elseif ordertarget==1 && _skill==0
		{
			OrderDone[1]=0
			if HLskill[0]>=2
			{	Bmp[1]+=1	//æœ€å‰é¢æ‰£éäº†è¦åŠ å›ä¾†
				"\p[6]\s[-1]\b[32]%(bp)æœ¬å›åˆå·²ç¶“ç™¼å‹•éå˜²è«·äº†ã€‚%(bp)"
			}
			else
			{
				HLskill[0]++
				"\p[2]%cp(3)\p[5]%BattleSurface('taunt')\p[6]\s[-1]\b[32]\c"
				--
				"%SFX('skill/01-HL-08-qu dis')"
				"%SFX('skill/01-HL-41-(beep)')"
				"%SFX('skill/01-HL-46-you dis')"
				"%SFX('skill/02-HL-59-coward')"
				"%SFX('skill/01-HL-93-xiao yang')"
				--
				"\i[20061]\b[12]\f[align,center]\n[120]/
				#@$&*@#$%^&!!!/
				\p[6]\s[-1]\b[32]\c%(bp)æ•µæ–¹è¢«æµ·æ‹‰çš„å„ªç¾çš„è©è—»æ·±æ·±æ‰“å‹•ï¼Œå°‡åœ¨ä¸‹ä¸€å›åˆé‡å°å¥¹ç™¼å‹•æ”»æ“Šï¼%(bp)"
			}
		}
		elseif ordertarget==1 && _skill==1
		{
			OrderDone[1]=0
			"\p[5]\i[676200]\p[6]\s[-1]\b[32]\c%SFX('sfx/power charge')"
			--
			if HLskill[0]>=1
				"%(bp) æµ·æ‹‰ çš„æ”»æ“Šä¸Šå‡ç‹€æ…‹å¢åŠ 3å›åˆï¼Œé‚„æœ‰%(HLskill[1])å›åˆçµæŸã€‚æ­¤æœŸé–“å…§ä¸æœƒæ¢å¾©èƒ½é‡ã€‚%(bp)"
			else
				"%(bp) æµ·æ‹‰ çš„æ”»æ“ŠåŠ›å¤§å¹…å¢åŠ ï¼è©²ç‹€æ…‹å°‡åœ¨%(HLskill[1])å›åˆå¾ŒçµæŸï¼ŒæœŸé–“å…§ä¸æœƒæ¢å¾©èƒ½é‡ã€‚%(bp)"
		}
		elseif ordertarget==1 && _skill==2
		{
			if HLskill[2]>2
			{	HLskill[2]-=2
				OrderDone[1]=0
				Bmp[1]+=3	//æœ€å‰é¢æ‰£éäº†è¦åŠ å›ä¾†
				"\p[2]%cp(3)\p[6]\s[-1]\b[32]\c%(bp) è©²æŠ€èƒ½å°šåœ¨å†·å»ä¸­ã€‚%(bp)"
			}
			else
			{
				_atkmode=1
				"\p[2]%cp(1)\p[5]%BattleSurface('skill')\p[6]\s[-1]\b[32]\c"
				--
				"%SFX('skill/02-HL-19-hai la wu shuang')"
				"%SFX('skill/02-HL-20-bie dang dao')"
				--
				"%SFX('exc/01-HL-19-hiu')%SFX('sfx/metal punch1')"
				"%SFX('exc/01-HL-19-hiu')%SFX('sfx/metal punch2')"
				"%SFX('exc/01-HL-19-hiu')%SFX('sfx/metal punch3')"
				"%SFX('exc/02-HL-28-hen')%SFX('sfx/metal punch1')"
				"%SFX('exc/02-HL-28-hen')%SFX('sfx/metal punch2')"
				"%SFX('exc/02-HL-28-hen')%SFX('sfx/metal punch3')"
				--
				"%(bp) æµ·æ‹‰ ç”¨å…¨èº«çš„åŠ›é‡ç—›æ“Š %(enemy_name) ï¼Œå°å…¶é€ æˆ %bh(Sdmg) é»å‚·å®³ï¼%(bp)"
				--
				crit_msg
			}
		}
		--
		//ä¸­æ¯’ä½œç”¨
		if ((ordertarget==0 && debuff_HC[0]>=1) || (ordertarget==1 && debuff_HL[0]>=1)) && _atkmode==1
			"\n\w7%(sfx_poison)%(bp) ä½†æ˜¯ï¼Œåœ¨ %(debuff_color[0])%(debuff_name[0])\f[default] çš„å½±éŸ¿ä¸‹ï¼Œæå¤±äº† %(debuff_color[0])%(_posionedhp)\f[default] é»HP %(bp)"
		--
		"\x"
		--
		if _atkmode==1
		{
			Sinner.HPCheck
			if hp[1]>0 ; EnemyBeenAttack
		}
	}
}
//èµ«å¡è’‚æŠ€èƒ½
CastSkillHC0
{
	OrderDone[0]=1
	HCskill[0]=1
	DecideSdmg
	--
	"\0\s[-1]\1\s[-1]\p[2]%cp(1)\p[5]\i[650031]\w5%BattleSurface('skill')\p[6]\s[-1]\b[32]\c\![set,choicetimeout,0]%(bp)"
	--
	"%SFX('sfx/Menyu o hiraku 2')"
	--
	"%SFX('skill/01-HC-54-dreamshadow')"
	"%SFX('skill/02-HC-27-dreamshadow')"
	"%SFX('skill/02-HC-29-dreamshadow')"
	"%SFX('skill/02-HC-57-nightmare')"
	"%SFX('skill/01-HC-55-defeat them')"
	--
	"èµ«å¡è’‚ æ–½å±• ç„¡å…‰ä¹‹é¡ å° %(enemy_name) é€ æˆ %bh(TOINT(Sdmg)) é»å‚·å®³ï¼"
	"èµ«å¡è’‚ è§£æ”¾å¤¢é­˜çš„åŠ›é‡å° %(enemy_name) æ”»æ“Šï¼Œé€ æˆ %bh(TOINT(Sdmg)) é»å‚·å®³ï¼"
	--
	"%(bp)"
	--
	//ä¸­æ¯’ä½œç”¨
	if debuff_HC[0]>=1
	{	hp[0]-=TOINT(HCinc[0]*0.1)
		"\n\w7%(sfx_poison)%(bp) ä½†æ˜¯ï¼Œåœ¨ %(debuff_color[0])%(debuff_name[0])\f[default] çš„å½±éŸ¿ä¸‹ï¼Œæå¤±äº† %(debuff_color[0])%TOINT(HCinc[0]*0.1)\f[default] é»HP %(bp)"
	}
	--
	"\x"
	--
	Sinner.HPCheck
	if hp[0]>0
	{	EnemyBeenAttack
		Bmp[0]--
		Sinner.MpCheck
		EnemyBeenAttack
	}
}
CastSkillHC1
{
	if Bmp[0]>=2
	{
		case HCskill[1]
		{
			when 0
			{
				HCskill[1]=5
				OrderDone[0]=1
				Bmp[0]-=2
				--
				"\p[6]\s[-1]\b[32]\c%SFX('sfx/gravity magic1')%(bp)èµ«å¡è’‚çš„å¤¢é­˜å°‡ç‚ºæˆ‘æ–¹ç¦é–‰è€…æŠµç¦¦æœ¬å›åˆçš„æ‰€æœ‰å‚·å®³ã€‚%(bp)"
				--
				"\x"
				--
				DecideWhoAct
			}
			when 1-5
			{
				"\p[6]\s[-1]\b[32]%SFX('sfx/Bipu-on 3')%(bp)æŠ€èƒ½å†·å»ä¸­ï¼Œå°šæœ‰%(HCskill[1])å›åˆã€‚%(bp)"
				--
				"\x"
				--
				BattleWarning
			}
		}
   }
   else
   {
		"\p[6]\s[-1]\b[32]\c%SFX('sfx/Bipu-on 3')%(bp)èµ«å¡è’‚çš„èƒ½é‡ä¸è¶³2é»ã€‚%(bp)"
		--
		"\x"
		--
		BattleWarning
   }
}
//æµ·æ‹‰æŠ€èƒ½
CastSkillHL0
{
	if Bmp[1]<2
		"\c\p[6]\s[-1]\b[32]%SFX('sfx/Bipu-on 3')%(bp)æµ·æ‹‰çš„èƒ½é‡ä¸è¶³2é»ã€‚%(bp)\x"
	else
	{
		HLskill[0]+=3
		Bmp[1]-=2
		--
		"\0\s[-1]\p[5]\i[676200]\p[6]\s[-1]\b[32]\c%SFX('sfx/power charge')%(bp)"
		--
		if HLskill[0]>=1
			"æµ·æ‹‰ çš„æ”»æ“Šä¸Šå‡ç‹€æ…‹å¢åŠ 3å›åˆï¼Œé‚„æœ‰%(HLskill[0])å›åˆçµæŸã€‚æ­¤æœŸé–“å…§ä¸æœƒæ¢å¾©èƒ½é‡ã€‚"
		else
			"æµ·æ‹‰ çš„æ”»æ“ŠåŠ›å¤§å¹…å¢åŠ ï¼è©²ç‹€æ…‹å°‡åœ¨%(HLskill[0])å›åˆå¾ŒçµæŸï¼ŒæœŸé–“å…§ä¸æœƒæ¢å¾©èƒ½é‡ã€‚"
		--
		"%(bp)\x"
		--
		BattleWarning
	}
}
CastSkillHL1
{
	case HLskill[1]
	{
		when 0
		  {HLskill[1]=1
		  Bmp[1]--
		  --
		  "%BattleSurface('taunt')"
		  --
		  "%SFX('skill/01-HL-08-qu dis')"
		  "%SFX('skill/01-HL-41-(beep)')"
		  "%SFX('skill/01-HL-46-you dis')"
		  "%SFX('skill/02-HL-59-coward')"
		  "%SFX('skill/01-HL-93-xiao yang')"
		  --
		  "\i[20061]\b[12]\f[align,center]\n[120]/
		  #@$&*@#$%^&!!!/
		  \p[6]\s[-1]\b[32]\c%(bp)æ•µæ–¹è¢«æµ·æ‹‰çš„å„ªç¾çš„è©è—»æ·±æ·±æ‰“å‹•ï¼Œå°‡åœ¨ä¸‹ä¸€å›åˆé‡å°å¥¹ç™¼å‹•æ”»æ“Šï¼%(bp)\x"
		  --
		  DecideWhoAct}
		when 1
		  {"\p[6]\s[-1]\b[32]\c%(bp)æœ¬å›åˆå·²ç¶“ç™¼å‹•éå˜²è«·äº†ã€‚%(bp)\x"
		  --
		  BattleWarning}
	}
    
}
CastSkillHL2
{
	if Bmp[1]<3
		"\c\p[6]\s[-1]\b[32]%(bp)æµ·æ‹‰çš„èƒ½é‡ä¸è¶³3é»ã€‚%(bp)\x"
	else
	{
		HLskill[2]=1
		OrderDone[1]=1
		DecideSdmg
		OrderDone[1]=1
		Bmp[1]-=3
		Sinner.MpCheck
		--
		"\0\s[-1]\1\s[-1]\p[2]%cp(1)\p[5]%BattleSurface('skill')\p[6]\s[-1]\b[32]\c"
		--
		"%SFX('skill/02-HL-19-hai la wu shuang')"
		"%SFX('skill/02-HL-20-bie dang dao')"
		--
		"%(bp) æµ·æ‹‰ ç”¨å…¨èº«çš„åŠ›é‡ç—›æ“Š %(enemy_name) ï¼Œå°å…¶é€ æˆ %bh(Sdmg) é»å‚·å®³ï¼%(bp)"
		--
		//ä¸­æ¯’ä½œç”¨
		if debuff_HL[0]>=1
		{	hp[1]-=TOINT(HLinc[0]*0.1)
			"\n\w7%(bp) ä½†æ˜¯ï¼Œåœ¨ %(debuff_color[0])%(debuff_name[0])\f[default] çš„å½±éŸ¿ä¸‹ï¼Œæå¤±äº† %(debuff_color[0])%TOINT(HLinc[0]*0.1)\f[default] é»HP %(bp)"
		}
		--
		"\x"
		--
		Sinner.HPCheck
		if hp[1]>0 ; EnemyBeenAttack
	}
}

//====================é˜²ç¦¦====================
//æŒ‡ä»¤-é˜²ç¦¦ï¼ˆå‚·å®³æ¸›å…åˆ¤å®šï¼‰
OrderDefense
{
	"\0\s[-1]\1\s[-1]\p[2]%cp(0)\p[5]"
	--
	case ordertarget
	{
		when 1
		{
			def[1]=0.3
			OrderDone[1]=1
			--
			"\i[676301]%SFX('sfx/shakiin3')\p[6]\s[-1]\b[32]\c%(bp) æµ·æ‹‰æ“ºå‡ºé˜²ç¦¦æ¶å‹¢ï¼Œæœ¬å›åˆç²å¾—è‡ªèº«å‚·å®³æ¸›å…ã€‚%(bp)\x"
		}
		when 0
		{
			def[0]=0.3
			OrderDone[0]=1
			--
			"\i[676300]%SFX('sfx/shakiin3')\p[6]\s[-1]\b[32]\c%(bp)èµ«å¡è’‚èº«å¾Œçš„å¤¢é­˜è®Šå¾—æ›´åŠ æ¸…æ™°äº†ï¼Œå°‡åœ¨æœ¬å›åˆç‚ºå¥¹å¸æ”¶éƒ¨åˆ†å‚·å®³ã€‚%(bp)\x"
		}
	}
	--
	DecideWhoAct
}

//====================å±€é•·æ¬Šèƒ½====================
ChiefPotestas
{
	"\0\s[-1]\1\s[-1]\p[6]\s[-1]\b[32]"
	--
	BattleInfoWindow
	--
	"\p[2]%cp(0)\b[24]\c\f[align,center]/
	\q[âœšå›å¾©HP,PotestaHeal]\n[170]/
	\q[âš¡å……èƒ½,PotestaEmpower]\n[170]/
	\q[âœ–éº»ç—ºæ•µäºº,PotestaStill]"
	--
	OrderCancel
}
ChiefMpNotEnough
{
	"\p[2]%cp(3)\p[6]\s[-1]\b[32]\c%(bp) å±€é•·èƒ½é‡ä¸è¶³ï¼Œç„¡æ³•ä½¿ç”¨æ¬Šèƒ½ï¼%(bp)\x"
	--
	BattleWarning
}
//æ¬Šèƒ½-å›å¾©HP
PotestaHeal
{
	if Bmp[2]==0
		ChiefMpNotEnough
	else
	{
		"\p[2]%cp(0)\b[24]\c\f[align,center]\![set,choicetimeout,0]/
		\q[âœšå–®äºº50%,HealOne]\n[200]/
		\q[âœšå…¨é«”30%,HealAll]"
		--
		OrderCancel
		--
		"\p[6]\s[-1]\b[32]"
		--
		BattleInfoWindow
	}
}
HealOne
{
	"\p[6]\s[-1]\b[32]\c%(bp)è¦ç‚ºèª°å›å¾©HPï¼Ÿ%(bp)"
	--
	BattleInfoWindow
	--
	"\p[2]%cp(0)\b[24]\c\f[align,center]\![set,choicetimeout,0]/
	%(opp)\q[ èµ«å¡è’‚ ,HealHC]\n[150]/
	%(opp)\q[ æµ·æ‹‰ ,HealHL]"
	--
	OrderCancel
}
HealHC
{
	if hp[0]>=HCinc[0]
	{
		"\p[6]\s[-1]\b[32]\c%(bp) èµ«å¡è’‚ çš„HPå·²ç¶“æ˜¯æ»¿çš„äº†ï¼Œç„¡éœ€å›å¾©ã€‚%(bp)\x"
		--
		DecideWhoAct
	}
	else
	{
		if HCinc[0]/hp[0]<=2
			hp[0]=HCinc[0]
		else
			hp[0]+=HCinc[0]/2
		--
		Bmp[2]-=1
		--
		"\p[5]\i[676100]\p[6]\s[-1]\b[32]\c%SFX('sfx/Taitoru hyoji')%(bp) å·²ç‚º èµ«å¡è’‚ å›å¾©%TOINT(HCinc[0]/2)é»HPã€‚%(bp)\x"
		--
		DecideWhoAct
	}
}
HealHL
{
	if hp[1]>=HLinc[0]
	{
		"\p[6]\s[-1]\b[32]\c%(bp) æµ·æ‹‰ çš„HPå·²ç¶“æ˜¯æ»¿çš„äº†ï¼Œç„¡éœ€å›å¾©ã€‚%(bp)\x"
		--
		DecideWhoAct
	}
	else
	{
		if HLinc[0]/hp[1]<=2
			hp[1]=HLinc[0]
		else
			hp[1]+=HLinc[0]/2
		--
		Bmp[2]-=1
		--
		"\0\s[-1]\p[5]\i[676101]\p[6]\s[-1]\b[32]\c%SFX('sfx/Taitoru hyoji')%(bp) å·²ç‚º æµ·æ‹‰ å›å¾©%TOINT(HLinc[0]/2)é»HPã€‚%(bp)\x"
		--
		DecideWhoAct
	}
}
HealAll
{
	"\p[6]\s[-1]\b[32]\c\![set,balloontimeout,0]%(bp)"
	--
	if hp[0]==HCinc[0] || hp[1]==HLinc[0]
	{
		"ä½†æ˜¯ï¼Œ"
		--
		if hp[0]==HCinc[0]
			"èµ«å¡è’‚"
		elseif hp[1]==HLinc[0]
			"æµ·æ‹‰"
		--
		"çš„HPå·²ç¶“æ˜¯æ»¿çš„äº†ã€‚"
	}
	elseif hp[0]==HCinc[0] && hp[1]==HLinc[0]
	{
		"å…©å€‹äººçš„HPéƒ½æ˜¯æ»¿çš„ã€‚"
	}
	else
	{
		if hp[0]+(HCinc[0]*0.3)>=HCinc[0]
			hp[0]=HCinc[0]
		else 
			hp[0]+=TOINT(HCinc[0]*0.3)
		--
		if hp[1]+(HLinc[0]*0.3)>=HLinc[0]
			hp[1]=HLinc[0]
		else 
			hp[1]+=TOINT(HLinc[0]*0.3)
		--
		"\0\s[-1]\p[6]%SFX('sfx/Taitoru hyoji')\i[676100]\i[676101]\p[6]å·²å›å¾©ç¦é–‰è€…çš„HPã€‚"
	}
	--
	"%(bp)"
	--
	BattleInfoWindow
	--
	"\x"
	--
	DecideWhoAct
}

//æ¬Šèƒ½-å……èƒ½
PotestaEmpower
{
	if Bmp[2][0]==0
		ChiefMpNotEnough
	else
	{
	"\c\p[6]\s[-1]\b[32]%(bp)è¦å›å¾©èª°çš„èƒ½é‡ï¼Ÿ%(bp)"
	--
	BattleInfoWindow
	--
	"\p[2]%cp(0)\b[24]\c\f[align,center]\n[111]%(opp)\q[ èµ«å¡è’‚ ,EmpowerHC]\n[150]/
	%(opp)\q[ æµ·æ‹‰ ,EmpowerHL]"
	--
	OrderCancel
	}
}
EmpowerHC
{
	if Bmp[0]==Bmp[3]
		{"\c\p[6]\s[-1]\b[32]%(bp) èµ«å¡è’‚çš„èƒ½é‡å·²æ»¿ï¼Œç„¡æ³•å†å¢åŠ äº†ã€‚%(bp)"}
	else
	{	Bmp[0]++
		Bmp[2]-=1
		--
		"\c\p[6]\s[-1]\b[32]%SFX('sfx/Geji kaifuku 2')%(bp) ç‚ºèµ«å¡è’‚å›å¾©1é»èƒ½é‡ã€‚%(bp)"}
	--
	BattleInfoWindow
	--
	"\x"
	--
	BattleWarning
}
EmpowerHL
{
	if Bmp[1]==Bmp[3]
		{"\c\p[6]\s[-1]\b[32]%(bp) æµ·æ‹‰çš„èƒ½é‡å·²æ»¿ï¼Œç„¡æ³•å†å¢åŠ äº†ã€‚%(bp)"}
	else
	{	Bmp[1]++
		Bmp[2]-=1
		--
		"\c\p[6]\s[-1]\b[32]%SFX('sfx/Geji kaifuku 2')%(bp) ç‚ºæµ·æ‹‰å›å¾©1é»èƒ½é‡ã€‚%(bp)"}
	--
	BattleInfoWindow
	--
	"\x"
	--
	BattleWarning
}
PotestaStill
{
	if Bmp[2]==0
		ChiefMpNotEnough
	else
	{
		OrderEffectMode=4
		Bmp[2]--
		BattleWarning
		--
		"\0\s[-1]\1\s[-1]\p[2]%cp(1)\p[5]\i[676401]\p[6]\c\s[-1]\b[32]\w5%SFX('sfx/paralyze')%(bp) å—æ¬Šèƒ½å½±éŸ¿ï¼Œæ•µäººå°‡ç„¡æ³•è¡Œå‹•ä¸€å›åˆã€‚%(bp)\x"
	}
}


//====================æˆ‘æ–¹å‚·å®³è¨ˆç®—===================
//æˆ‘æ–¹å‚·å®³åˆ¤å®š
DecideSdmg
{
	_cri=RAND(100) ; crit_msg=""
	if _cri<=crit[ordertarget] { crit_dmg=1.66 ; crit_msg="\n[150]%(bp) æ“Šä¸­äº†è¦å®³ï¼%(bp)" }
	else ; crit_dmg=1
	case ordertarget
	{
		when 1
		{
			//åŸºç¤æ”»æ“Š
			Sdmg=TOINT(HLinc[1]*crit_dmg)
			if HLskill[1]>=1 ; Sdmg=TOINT(Sdmg*1.7)		//å¢æ”»
			if HLskill[2]>=2 ; Sdmg=Sdmg*5			//é‡æ“Š
		}
		when 0
		{
			//åŸºç¤æ”»æ“Š
			Sdmg=TOINT(HCinc[1]*crit_dmg)
			if HCskill[0]==1
				Sdmg=Sdmg*2.5
		}
	}
}



//==================================================
//-------------------æ•µæ–¹è¡Œå‹•-------------------
//==================================================
//æ•µæ–¹å—æ“Š
EnemyBeenAttack
{
  if Ehp<=Sdmg
	Ehp=0
  elseif Ehp>Sdmg
	Ehp-=Sdmg
  --
  EnemyHPCheck
}
//æ•µæ–¹è¡€é‡åˆ¤å®š-æ•µæ–¹å›åˆoræ•µæ–¹æ­»äº¡
EnemyHPCheck
{
	BattleMode=3
	--
	if enemy_name=="å¯¦é©—äººå“¡" && Ehp==0
	{	
		_i= ASEARCH ("å¯¦é©—äººå“¡",enemy_list_name)
		cum_enemy[_i] = TOINT (cum_enemy[_i]) ; cum_enemy[_i] ++
		enemy_name="è—è •èŸ²"
		--
		"\p[2]%cp(1)\p[5]%BattleSurface('idle')\p[6]\s[-1]\b[32]\c\![quicksession,false]%(bp) æ•µäººæ”¹è®Šäº†å‹æ…‹ï¼%(bp)\w9"
		--
		Einc=(Einc_C[0]*2,Einc_C[1]*1.5)
		Ehp=Einc[0] 
		NextRound
	}
	elseif Ehp==0
    {
		//æ“Šæ•—æ•µæ–¹æ¼”å‡º
		EnemyDropItemSetting
		_en = ASEARCH (enemy_name,enemy_list_name)
		cum_enemy[_en] = TOINT (cum_enemy[_en]) ; cum_enemy[_en] ++
		--
		"%BattleSurface('idle')\![bind,enemy,%(enemy_name)-defeated,1]\p[6]\s[-1]\b[32]\c\![quicksession,false]%(bp)%SFX('sfx/decision button2') æ“Šæ•—äº† %(enemy_name) ï¼%(bp)\w9\w5\n[200]/
		\_q%(bp)%SFX('sfx/decision button2') ç²å¾—%(Edrop[0])ç¶“é©—å€¼ %(bp)\_q\w9"
		--
		WhenExpGet
		--
		if Edrop[1]>=1 ; "\n[150]\_q%(bp)%SFX('sfx/decision button2') ç²å¾— \f[color,#ECAA36]%(Edrop[1])ç‹„æ–¯å¹£\f[default] %(bp)\_q\w9"
		--
		//å¼·åŒ–é“å…·
		_txt=""
		for _i=2 ; _i<=4 ; _i++
		{
			_k=_i-2
			if Edrop[_i]>=1
			{
				_txt+="\n[150]\_q%(bp)%SFX('sfx/decision button2') ç²å¾— %(Edrop[_i]) å€‹ %(enhancement_color[_k])%(Edrop_name[_i])\f[default] %(bp)\_q\w9"
				--
				enhancement[_k]+=Edrop[_i]
			}
		}
		_txt
		--
		//æˆ°åˆ©å“
		if enemy_name _in_ TOSTR(loot_enemy_name) ; "\n[150]\_q%(bp)%SFX('sfx/decision button2') ç²å¾—äº† \f[color,#80FFFF]%(Edrop[5])\f[default]ï¼%(bp)\_q\w9"
		--
		if Edrop[6] != ""
		{	"\n[150]\_q%(bp)%SFX('sfx/decision button2') ç²å¾—"
			--
			if mapname=="RustRiver" ; " 2å€‹"
			else ; "äº†"
			--
			" %(Edrop[6])ï¼%(bp)\_q\w9"
		}
		--
		if Edrop[7]>=1 ; "\n[150]\_q%(bp)%SFX('sfx/decision button2') ç²å¾— %(Edrop[7])å€‹ \f[color,#d8bfd8]æ„ŸæŸ“å‡è† \f[default]ã€‚%(bp)\_q\w9"
		--
		if GETTYPE(Edrop[8])==3 ; "\n[150]\_q%(bp)%SFX('sfx/decision button2') ç²å¾— \f[color,#FFBB77]%(Edrop[8])\f[default]ã€‚%(bp)\_q\w9"
		--
		"\x"
		--
		AddWave
	}
	elseif Ehp<=10
    {
		"\p[6]\s[-1]\b[32]\c%(bp)"
		--
		"%(enemy_name) å› ç‚ºå®³æ€•è€Œé€ƒèµ°äº†â€¦â€¦"
		"%(enemy_name) æ…Œæ…Œå¼µå¼µåœ°é€ƒè·‘äº†â€¦â€¦"
		--
		"%(bp)\x"
		--
		wave[0]++
		NextWave
	}
	elseif Ehp>10
		DecideWhoAct
}



//====================================================
//-------------------æˆ°é¬¥çµæŸå¾Œæ“ä½œ-------------------
//====================================================
EnemyDropItemSetting	//----------æ•µæ–¹å–®ä½æ‰è½é“å…·ï¼Œåœ¨æ­¤äº‹ä»¶ä¸­ç²å¾—ç›¸æ‡‰é“å…·(é™¤å¼·åŒ–é“å…·)
{
	//0exp,1ç‹„æ–¯å¹£,2ç‹‚äº‚ç²¾ç²¹,3ç•°èƒ½æºæ¶²,4ç‹‚æš´æºæ¶²,5æˆ°åˆ©å“,6åŸç¤¦,7æ„ŸæŸ“å‡è† ,8æœˆä¾›ç‰©å“
	Edrop=(TOINT(level*53.1472+RAND(level)+level*30*batlle_level*0.1),0,RAND(level/10),0,0,"","",0,RAND(10))
	//-----exp
	if mapname=="ParmaRuins" ; Edrop[0]=TOINT(Edrop[0]*1.7)
	if mapname=="RustRiver" ; Edrop[0]=Edrop[0]*3
	if enemy_name=="ï¼Ÿï¼Ÿï¼Ÿ" ; Edrop[0]=TOINT(Edrop[0]*10.7+RAND(level))
	exp+=Edrop[0]
	//-----ç‹„æ–¯å¹£
	if mapname=="Syndicate" ; Edrop[1]=TOINT(level*3.456+RAND(level)+RAND(batlle_level))
	discoin+=Edrop[1]
	cum_gain_discoin[1]+=Edrop[1]
	//-----ç•°èƒ½orç‹‚æš´æºæ¶²ï¼ˆéœ€æ‰‹å‹•æ›´æ–°ï¼‰
	case enemy_name
	{
		when "åˆ€ç‹©","å¹«æ´¾æ‰“æ‰‹","ä¸‰è§’é ­","èšåˆé«”","é­Ÿé­š","æ·šäººå…’" ; Edrop[4]=RAND(level/10)
		when "å¤±å¿ƒè€…","å…œå¸½å®¢å·¥åŒ ","ç´…æ°´æ¯","å„ç¨®","å©•å…‹å—ç“œ","æ†‚é¬±çš„å©¦äºº" ; Edrop[3]=RAND(level/10)
	}
	//-----æˆ°åˆ©å“
	_a=ASEARCHEX(enemy_name,loot_enemy_name)
	_a=ANY(_a)
	Edrop[5]=loot_name[_a]
	if enemy_name _in_ TOSTR(loot_enemy_name)
	{	if loot[_a]=="" ; loot[_a]=1
		else ; loot[_a]++
	}
	//-----æŸ“æ–™åŸç¤¦
	_b=ASEARCH(enemy_name,enemy_list_name)
	_c=""
	case enemy_name
	{	when "ç´…æ°´æ¯" ; _c=0
		when "å©•å…‹å—ç“œ" ; _c=1
		when "é­Ÿé­š","è—è •èŸ²" ; _c=2
		when "å„ç¨®","æ­»ç¥" ; _c=3
		when "èšåˆé«”","æ·šäººå…’" ; _c=4
	}
	if _c!=""
	{
		Edrop[6]=dye_ingredient_name[_c]
		dye_ingredient[_c]++
		cum_ingredient[_c]=TOINT(cum_ingredient[_c]) ; cum_ingredient[_c]++
		if mapname=="ParmaRuins"
		{	dye_ingredient[_c]++ ; cum_ingredient[_c]=TOINT(cum_ingredient[_c]) ; cum_ingredient[_c]++	}
	}
	//-----æ„ŸæŸ“å‡è† 
	case enemy_name
	{	when "ç´…æ°´æ¯","æ·šäººå…’" ; Edrop[7]=3
		when "ï¼Ÿï¼Ÿï¼Ÿ" ; Edrop[7]=10
		when "é­Ÿé­š" ; Edrop[7]=1
	}
	if Edrop[7]>0
	{	dye_ingredient[5]+=Edrop[7] ; cum_ingredient[5]=TOINT(cum_ingredient[5]) ; cum_ingredient[5]+=Edrop[7] }
	//-----æœˆä¾›ç‰©å“
	if mapname=="RustRiver" && Edrop[8]==1
	{ case month
	 {
		when 3 { gift_sp[4]=TOINT(gift_sp[4]) ; gift_sp[4]++ ; Edrop[8]=gift_sp_name[4] }
		when 4 { gift_sp[5]=TOINT(gift_sp[5]) ; gift_sp[5]++ ; Edrop[8]=gift_sp_name[5] }
	 }
	}
	
}


//åˆ¤å®šè¡Œå‹•å°è±¡
DecideWhoAct
{
	if OrderDone[0]*OrderDone[1]*OrderDone[2]==1
		NextRound
	elseif OrderDone[0]*OrderDone[1]==1
		Enemy.Act
	elseif OrderDone[1]==1
		{ordertarget=0
		BattleWarning}
	elseif OrderDone[0]==1
		{ordertarget=1
		BattleWarning}
	else
		BattleWarning
}



//==========æ•µæ–¹å›åˆ==========
Enemy.Act
{
	Enemy.Act.Action	//æ±ºå®š enemy_action
	--
	Edmg[0]=TOINT(Einc[1]*def[0])
	Edmg[1]=TOINT(Einc[1]*def[1])
	OrderDone[2]=1
	--
	//æ•µæ–¹æŠ€èƒ½ç‰¹æ®Šè™•ç†
	if enemy_action=="skill"
	{
		_rate=0
		case enemy_name
		{
			when "å©•å…‹å—ç“œ" ; Eskill=("è©­è¨ˆ",2)
			when "é­Ÿé­š" ; Eskill=("ç”©å°¾",1)
			when "æ†‚é¬±çš„å©¦äºº" ; Eskill=("æ”¶å‰²",RAND(6))
			//when "" ; Eskill=("",1)
		}
	}
	--
	case enemy_action
	{	when "hecate" ; Edmg[2]=Edmg[0]
		when "hella" ; Edmg[2]=Edmg[1]		}
	--
	if OrderEffectMode==4			//-----æ¬Šèƒ½éº»ç—º
	{
		"\p[6]\s[-1]\b[32]\c%SFX('sfx/chin 2')%(bp) ç”±æ–¼éº»ç—ºæ•ˆæœï¼Œæ•µæ–¹ç„¡æ³•è¡Œå‹•ã€‚%(bp)\x"
		--
		NextRound
	}
	elseif HCskill[1]>=5			//-----å¤¢é­˜æ‰¿å‚·
	{
		"\p[2]%cp(1)%BattleSurface('dreamshadow')\p[6]\s[-1]\b[32]%(bp)å¤¢é­˜ç‚ºå…©äººæ“‹ä¸‹äº†æ­¤æ¬¡å‚·å®³ã€‚%(bp)\x"
		--
		NextRound
	}
	elseif enemy_action=="skill"	//-----ç™¼å‹•æŠ€èƒ½
	{	if Eskill[0]=="è©­è¨ˆ"
		{	attack_target=ANY(0,1)
			if attack_target==1 ; debuff_HL[3]=2
			elseif attack_target==0 ; debuff_HC[3]=2
			--
			"\p[2]%cp(2)\p[5]%BattleSurface('hurt')\p[6]\s[-1]\b[32]\c%(bp) %(enemy_name) å° %(Char_Name[attack_target]) æ–½å±•äº† %(Eskill[0])ï¼%(bp)\w5\n/
			%(bp) %(Char_Name[attack_target]) è¢«å¥¹çš„ä¸‰å¯¸ä¸çˆ›ä¹‹èˆŒèªªæœï¼Œå°‡ä¸åœ¨ä¸‹å›åˆä½¿ç”¨æŠ€èƒ½ã€‚%(bp)\x"
		}
		elseif Eskill[0]=="ç”©å°¾"
		{	SinnerBeenAttack
			--
			_rate=(RAND(3),RAND(3))
			_a=ANY("",2,3) ; _b=ANY(1,2)
			"\p[2]%cp(2)\p[5]%BattleSurface('aoe')\![sound,play,sound/enemy/swing%(_a).mp3]\![sound,play,sound/enemy/Muchi de kogeki %(_b).mp3]\p[6]\s[-1]\b[32]\c%(bp) %(enemy_name) å° ç¦é–‰è€…å€‘ ä½¿å‡ºäº† %(Eskill[0])ï¼%(bp)\w5\n/
			%(batlle_msg)%(bp) å° èµ«å¡è’‚ é€ æˆ %bh(Edmg[0]) é»å‚·å®³ï¼%(bp)\w3\n/
			%(batlle_msg)%(bp)  å° æµ·æ‹‰ é€ æˆ %bh(Edmg[1]) é»å‚·å®³ï¼%(bp)"
			--
			if _rate[0]==1
				{ "\w5\n%(sfx_poison)%(bp) èµ«å¡è’‚ %(debuff_color[0])ä¸­æ¯’\f[default]äº†ï¼%(bp)" ; debuff_HC[0]+=4 }
			--
			if _rate[1]==1
				{ "\w5\n%(sfx_poison)%(bp) æµ·æ‹‰ %(debuff_color[0])ä¸­æ¯’\f[default]äº†ï¼%(bp)" ; debuff_HL[0]+=4 }
			--
			"\x"
		}
		elseif Eskill[0]=="æ”¶å‰²"
		{
			SinnerBeenAttack
			--
			"\p[2]%cp(2)\p[5]%BattleSurface('aoe')\w9\w5\![sound,play,sound/enemy/Katana no soburi 1.mp3]\p[6]\s[-1]\b[32]\c%(bp) %(enemy_name) èˆ‰èµ·é®åˆ€å‘ æˆ‘æ–¹æ‰€æœ‰äºº ç å»â€¦â€¦ %(bp)\w5\n/
			%(batlle_msg)%(bp) å° èµ«å¡è’‚ é€ æˆ %bh(Edmg[0]) é»å‚·å®³ï¼%(bp)\w3\n/
			%(batlle_msg)%(bp)  å° æµ·æ‹‰ é€ æˆ %bh(Edmg[1]) é»å‚·å®³ï¼%(bp)"
			--
			//æ¼”å‡ºæ’å…¥
			Bmp[0]-- ; Bmp[1]--
			if Bmp[0]<0 ; Bmp[0]=0
			if Bmp[1]<0 ; Bmp[1]=0
			--
			if Eskill[1]<=2
				"\w5\n%(bp) â€¦â€¦â€¦â€¦ %(bp)\w7\n%(batlle_msg)%(bp) çªç„¶æ„Ÿåˆ°ä¸€é™£ç„¡åŠ›â€¦â€¦ %(bp)\w7\n/
				%(batlle_msg)%(bp) ç¦é–‰è€…å€‘ æå¤±äº† 1 é»èƒ½é‡â€¦â€¦â€¦â€¦ %(bp)"
			--
			if Eskill[1]==2
			{	Bmp[2]--
				if Bmp[2]<0 ; Bmp[2]=0
				--
				"\w9\n%(batlle_msg)%(bp) %(username) æå¤±äº† 1 é»èƒ½é‡â€¦â€¦â€¦â€¦ %(bp)"
			}
			--
			if Eskill[1]<=1
				"\w9\n%(batlle_msg)%(bp) åœ¨ ç¦é–‰è€…å€‘ çš„å¥®åŠ›æŠµæ“‹ä¸‹ï¼Œ%(username) æ²’æœ‰æå¤±èƒ½é‡ã€‚%(bp)"
			--
			"\x"
		}
		--
		if hp[0]<=0 || hp[1]<=0 ; Sinner.HPCheck
		else ; NextRound
	}
	elseif enemy_action=="idle"	//-----å¾…æ©Ÿè¡Œå‹•
	{	
		"\p[2]%cp(2)\p[6]\s[-1]\b[32]\c"
		--
		case enemy_name
		{
			when "ï¼Ÿï¼Ÿï¼Ÿ"
			{ case roundNum
			  {
				when 1 ; "%(bp) â€¦â€¦â€¦â€¦ %(bp)"
				when 2 ; "%(bp) ï¼Ÿï¼Ÿ ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ï¼Ÿ ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ %(bp)"
				when 3 ; "%(bp) ã€ŒÒ‰å§£Ò‰å¶ˆÒ‰ÎšÒ‰é¦Ò‰ã„§Ò‰æ¹…Ò‰é’Ò‰æ¢±Ò‰oÒ‰uÒ‰ã€ %(bp)"	//å§£å¶ˆÎšé¦ã„§æ¹…é’æ¢±ou æ¯è¦ªåœ¨çœ‹è‘—you
				when 4 ; "%(bp) ã€ŒÒ‰è¹‡Ò‰î‚¦Ò‰ç²¸Ò‰é”›Ò‰å²„Ò‰äº·Ò‰æ¸šÒ‰å—˜Ò‰åœÒ‰é–«Ò‰æ¬“Ò‰å€Ò‰ã€ %(bp)"	//è¹‡î‚¦ç²¸é”›å²„äº·æ¸šå—˜åœé–«æ¬“å€  å¿«é»ï¼Œéä¾†æˆ‘é€™é‚Š
				when 5 ; "%(bp) ã€ŒÒ‰éœÒ‰å±¾Ò‰åœÒ‰æ¶“Ò‰â‚¬Ò‰ç’§Ò‰å³°Ò‰æ´–Ò‰hÒ‰oÒ‰mÒ‰eÒ‰ã€ %(bp)"	//éœå±¾åœæ¶“â‚¬ç’§å³°æ´–home  å’Œæˆ‘ä¸€èµ·å›home
				when 6 ; "%(bp) ã€ŒÒ‰é´Ò‰æ„®Ò‰å¤Ò‰é”›Ò‰å±¾Ò‰åœÒ‰éŠÒ‰æˆ Ò‰æ®‘Ò‰æ¶“Ò‰â‚¬Ò‰æµ Ò‰è—‰Ò‰ç“™Ò‰ã€ %(bp)"	//é´æ„®å¤é”›å±¾åœéŠæˆ æ®‘æ¶“â‚¬æµ è—‰ç“™  æˆç‚ºï¼Œæˆ‘å€‘çš„ä¸€ä»½å­
				when 7-999 ; "%(bp) ä¼¼é­šéäººçš„ç”Ÿç‰©ç™¼å‡ºæ²™å•çš„ä½å¼ï¼Œé‚£å€‹è²éŸ³ä½¿%(you)%ANY('åèƒƒ','ä½œå˜”','æ„Ÿåˆ°ä¸€é™£çœ©æšˆ')â€¦â€¦ %(bp)"
			  }
			}
			when "é­Ÿé­š" ; "%(batlle_msg)%(bp) %(enemy_name) é¢å¸¶å¾®ç¬‘åœ°çœ‹è‘—%(you)ï¼ %(bp)"
			when "æ†‚é¬±çš„å©¦äºº" ; "%(batlle_msg)%(bp) %(enemy_name) æ­£åœ¨ä½è²å•œæ³£â€¦â€¦ %(bp)"
		}
		--
		"\x"
		--
		NextRound
	}
	else							//-----æ™®é€šæ”»æ“Š
	{
		SinnerBeenAttack
		--
		"\p[2]%cp(2)\p[5]%BattleSurface('hurt')\p[6]\s[-1]\b[32]\c%(bp)%SFX('sfx/Yumiya ga sasaru') %(enemy_name) å° "
		--
		if enemy_action=="hecate" || enemy_action=="hella"
			"%(AttackTarget) é€ æˆäº† %bh(Edmg[2]) é»å‚·å®³ï¼"
		else
			"èµ«å¡è’‚ é€ æˆäº† %bh(Edmg[0]) é»å‚·å®³ï¼%(bp)\w3\n%(bp) %(enemy_name) å° æµ·æ‹‰ é€ æˆäº† %bh(Edmg[1]) é»å‚·å®³ï¼"
		--
		"%(bp)\x\p[5]\b[-1]%BattleSurface('idle')"
		--
		if hp[0]<=0 || hp[1]<=0 ; Sinner.HPCheck
		else ; NextRound
	}
}
//åˆ¤å®šæ”»æ“Šç›®æ¨™
Enemy.Act.Action
{
	_a=RAND(2)
	enemy_action_num=RAND(2)
	--
	//====åˆ†é¡æ”»æ“Šæ¨¡å¼====
	case enemy_name
	{
		//----ç¶“å…¸ä¸‰å–ä¸€
		when "æ·šäººå…’"
			enemy_action_num=RAND(3)
		//----å–®é«”oræŠ€èƒ½
		when "å©•å…‹å—ç“œ"
			enemy_action_num=ANY(0,1,3)
		//----æµ·æ‹‰orå…¨é«”
		when "èšåˆé«”"
			enemy_action_num=ANY(1,2)
		//----å¿…ç‚ºæŠ€èƒ½(1/2æ¦‚ç‡ç™¼å‹•)
		when "æ†‚é¬±çš„å©¦äºº"
			enemy_action_num=ANY(3,4)
		//----å¿…ç‚ºæŠ€èƒ½(2/3æ¦‚ç‡ç™¼å‹•)
		when "é­Ÿé­š"
			enemy_action_num=ANY(4,3,3)
		//----å¿…ç‚ºå…¨é«”æ”»æ“Š
		when "å…œå¸½å®¢å·¥åŒ ","ç´…æ°´æ¯","ä¸‰è§’é ­","è—è •èŸ²"
			enemy_action_num=2
		//----å¿…å®šæ”»æ“Šæµ·æ‹‰(å‰æ’)
		when "å„ç¨®"
			enemy_action_num=1
		//----å¿…å®šå¾…æ©Ÿ
		when "ï¼Ÿï¼Ÿï¼Ÿ"
			enemy_action_num=4
	}
	--
	//æŠ€èƒ½ç™¼å‹•æ¦‚ç‡èª¿æ•´
	//_rate=0
	//if enemy_name=="æ†‚é¬±çš„å©¦äºº" && enemy_action=="skill"
	//	enemy_action=ANY("idle","skill")
	
	//elseif enemy_name=="å©•å…‹å—ç“œ" && enemy_action=="skill"
	//	enemy_action=ANY("idle","skill")
	--
	//å˜²è«·
	if HLskill[1]==1 && enemy_action_num==0
		enemy_action_num=1
	--
	enemy_action=enemy_action_list[enemy_action_num]
	enemy_attacktarget_name=enemy_attacktarget_list[enemy_action_num]
	--
	case enemy_action
	{	when "hella"  ; {attack_target=1 ; AttackTarget="æµ·æ‹‰"}
		when "hecate" ; {attack_target=0 ; AttackTarget="èµ«å¡è’‚"}
		when "aoe"	  ; {attack_target=2 ; AttackTarget="ç¦é–‰è€…å€‘"}		}
}

//ç¦é–‰è€…(æˆ‘æ–¹)æè¡€ã€å—æ“Šæ™‚ç‰¹æ®Šç‹€æ…‹/è¿´é¿åˆ¤å®š
SinnerBeenAttack
{
	_eva=(RAND(100),RAND(100))	//éš¨æ©Ÿè¿´é¿
	if HCskill[1]==5
		"\c\p[6]\s[-1]\b[32]%(bp) å¤¢é­˜ç‚ºèµ«å¡è’‚å’Œæµ·æ‹‰æŠµç¦¦äº†è©²æ¬¡å‚·å®³ã€‚%(bp)\w8"
	/*elseif _eva[attack_target]<=evasion[attack_target] && attack_target<2	//è¿´é¿
		"\c\p[6]\s[-1]\b[32]%(bp) %(AttackTarget) èº²é–‹äº†æ”»æ“Šï¼%(bp)\w8"*/
	elseif enemy_action=="hecate"
		hp[0]-=Edmg[0]
	elseif enemy_action=="hella"
		hp[1]-=Edmg[1]
	elseif enemy_action=="aoe"
	{	hp[0]-=Edmg[0] ; hp[1]-=Edmg[1]	}
	elseif enemy_action=="skill" && (enemy_name=="é­Ÿé­š"||enemy_name=="æ†‚é¬±çš„å©¦äºº")
	{	hp[0]-=Edmg[0] ; hp[1]-=Edmg[1]	}
}
Sinner.HPCheck
{
	if hp[0]*hp[1]<=0
	{	_a= ASEARCH (mapname,map_name_en)
		cum_battle_fall[_a]++
		intimacy[1]-=20
		cum_int_down_HL[1]+=20
	}
	if hp[0]<=0 ; Defeated.Hecate
	elseif hp[1]<=0 ; Defeated.Hella
}
Sinner.MpCheck
{
	if Bmp[0]<0 ; Bmp[0]=0
	if Bmp[1]<0 ; Bmp[1]=0
	if Bmp[0]>3 ; Bmp[0]=3
	if Bmp[1]>3 ; Bmp[1]=3
}
Defeated.Hecate
{
	hp[0]=0
	mood[0]-=40 ; mood[1]-=20
	--
	"\p[2]%cp(2)\p[6]\c\s[-1]\b[32]\![quicksession,false]%(bp) èµ«å¡è’‚ç„¡æ³•æ‰¿å—å‚·å®³ï¼Œæ˜äº†éå»ã€‚%(bp)\w8"
	--
	BattleInfoWindow
	--
	"\0\s[-1]\1\s[-1]\p[5]\s[520052]\b[10]\![quicksession,false]"
	--
	"%(usernameHC)â€¦â€¦å¿«â€¦â€¦é€ƒâ€¦â€¦"
	"å°ä¸èµ·â€¦â€¦æ²’èƒ½ä¿è­·å¥½%(you)â€¦â€¦"
	--
	"\w7\p[5]\b[12]\cèµ«å¡è’‚ï¼ï¼ï¼"
	--
	"\w9"
	--
	"\p[6]\s[-1]\b[32]\c%(bp) "
	--
	"æŠ±è‘—æ˜è¿·çš„èµ«å¡è’‚å›åˆ°äº†ç®¡ç†å±€â€¦â€¦"
	"æŠ±è‘—å‚·ç—•çºçºçš„èµ«å¡è’‚é€ƒé›¢äº†æˆ°å ´â€¦â€¦"
	--
	"%(bp)\x"
	--
	BattleMode=0
	DeleteAllBattleVar
	--
	"\p[5]\s[-1]\0\s[1]\1\s[31]/
	\1\s[31]â€¦â€¦\w2èµ«å¡è’‚ï¼Ÿ\w5å¦³é‚„å¥½å—ï¼Ÿ\w9/
	\0\s[1]â€¦â€¦æ²’äº‹çš„ï¼Œ\w5æµ·æ‹‰ï¼Œ\w5æˆ‘æ„Ÿè¦ºä¸åˆ°ç—›â€¦â€¦\w9\w9\w5/
	\1%(nl)\s[17]**å–‚ï¼ï¼ï¼\w5%(you)é€™å‚¢ä¼™ï¼\w6é€™éº¼ä¸å°å¿ƒï¼Œ\w5è¦ã€\w3\s[31]è¦æ˜¯èµ«å¡è’‚å‡ºäº†ä»€éº¼äº‹â€¦â€¦\w9\w2/
	\p[2]%(cp)\b[20]å°ä¸èµ·â€¦â€¦\w7\w9/
	\0%(nl)\s[3]æŠ±æ­‰ï¼Œ\w3æˆ‘èƒ½åŠ›ä¸è¶³æ‹–ç´¯ä½ å€‘äº†ã€‚\w9\w2/
	\1%(nl)\s[32]æ˜æ˜æ˜¯é€™å®¶ä¼™çš„æŒ‡æ®æœ‰å•é¡Œå•¦ï¼\w8\s[30]â€¦\w1â€¦\w8\n[130]è©±èªªå›ä¾†ï¼Œ\w6%(you)æ²’æœ‰å—å‚·å§ï¼Ÿ\w9/
	\p[2]%(cp)\b[20]\cæ²’æœ‰â€¦â€¦\w9\w9\w5/
	\1%(nl)\s[35]æˆ‘å¯æ²’æœ‰åœ¨æ“”å¿ƒ%(you)å•Šï¼Ÿ\w8 \s[34]æˆ‘æ˜¯æƒ³å¦‚æœ%(you)å—å‚·äº†ï¼Œ\w5å°±ä¾†ç‹ ç‹ å˜²ç¬‘%(you)ï¼\w7\w9\n[130]â€¦\w2â€¦\w3\s[13]åæ­£ï¼Œ\w5%(you)æ²’äº‹å°±å¥½äº†ã€‚\w9/
	\0%(nl)\s[1]ç‚ºäº†ä¿è­·å¥½%(usernameHC)ï¼Œ\w7æˆ‘ä¹Ÿæœƒç¹¼çºŒä¿®ç…‰çš„ã€‚\w5"
	--
	"\e"
}
Defeated.Hella
{
	hp[1]=0
	mood[0]-=20 ; mood[1]-=40
	--
	"\0\s[-1]\1\s[-1]\p[2]%cp(2)\p[6]\s[-1]\c\![quicksession,false]\b[32]%(bp) æµ·æ‹‰å‚·å¾—å¤ªé‡ï¼Œç„¡æ³•åœ¨çŸ­æœŸå…§å›å¾©å‚·å£ã€‚%(bp)\w8"
	--
	BattleInfoWindow
	--
	"\![quicksession,false]\p[5]\s[520053]\b[12]"
	--
	"â€¦â€¦å¥½â€¦â€¦ç—›â€¦â€¦"
	"å—šâ€¦â€¦"
	--
	"\w9\p[5]\b[10]\cæµ·æ‹‰çš„ç‹€æ³å¾ˆä¸å¦™ï¼Œæˆ‘å€‘å…ˆå›å±€è£¡å§ï¼Œ%(usernameHC)ï¼Ÿ\w9"
	--
	"\p[6]\s[-1]\b[32]\c%(bp) "
	--
	"èµ«å¡è’‚è®“å¤¢é­˜æŠ±è‘—å—é‡å‚·çš„æµ·æ‹‰å›åˆ°äº†å±€è£¡â€¦â€¦"
	"èµ«å¡è’‚æ“æ§å¤¢é­˜æŠ±è‘—å‚·ç—•çºçºçš„æµ·æ‹‰é€ƒé›¢äº†æˆ°å ´â€¦â€¦"
	--
	"%(bp)\x"
	--
	BattleMode=0
	DeleteAllBattleVar
	--
	"\p[5]\s[-1]\0\s[0]\1\s[10]/
	\1\s[19]å—šâ€¦â€¦\w7/
	\0\s[3]æµ·æ‹‰ï¼Œ\w5æˆ‘ä¾†å¹«å¦³åŒ…ç´®å§ã€‚\w9/
	\1%(nl)\s[31]ä¸ç”¨å•¦ï¼Œ\w5æˆ‘å·²ç¶“å¥½å¾—å·®ä¸å¤šäº†â€¦â€¦\w9/
	\0%(nl)\s[1]é‚£å°±å¥½ã€‚\w9\w9/
	\1%(nl)\s[17]*æ–‡æ˜*â€¦â€¦\w2%(you)\w2%(you)\w3%(you)\w2%(you)\w3%(you)ï¼\w3ç¬¨è›‹ï¼\w5å¤§ç¬¨è›‹ï¼ï¼\w5å°±ç®—å‚·å£èƒ½å¾ˆå¿«å¾©åŸï¼Œ\w7\s[31]æˆ‘é‚„æ˜¯æœƒç—›çš„å•Šï¼\w9/
	\p[2]%cp(0)å°ä¸èµ·â€¦â€¦\w9/
	\1%(nl)\s[11]å“¼ï¼Œ\w3é€™æ¬¡å…ˆåŸè«’%(you)ï¼Œ\w6è¦æ˜¯é‚„æœ‰ä¸‹æ¬¡ï¼Œ\w6\s[17]æˆ‘å¯è¦æŠŠ%(you)ææˆè±¬é ­å›‰ï¼\w9/
	\0%(nl)\s[3]é‚£æ¨£æœƒè¢«æˆ‘é˜»æ­¢çš„ã€‚\w9\n[130]\s[0]%(usernameHC)ï¼Œ%(you)æœ‰å—å‚·å—ï¼Ÿ\w9/
	\p[2]\cæ²’æœ‰â€¦â€¦\w9/
	\0%(nl)\s[1]å—¯ï¼Œ\w3é‚£æˆ‘å°±æ”¾å¿ƒäº†ã€‚\w9\w5/
	\1%(nl)\s[30]æˆ‘è¦å»åŠ ç·Šè¨“ç·´äº†ï¼Œ\w8\s[34]ä¸‹æ¬¡å†æ‰¾é‚£äº›è‡­å‚¢ä¼™å¥½å¥½ç®—å¸³ï¼\w8å˜¿å˜¿ã€‚"
	--
	"\e"
}
Defeated.Both
{
	hp=(0,0)
	--
	"\c\p[6]\s[-1]\b[32]%(bp) æµ·æ‹‰å‚·å¾—å¤ªé‡ï¼Œç„¡æ³•åœ¨çŸ­æœŸå…§å›å¾©å‚·å£ã€‚%(bp)\w8"
	--
	BattleInfoWindow
	--
}
Defeated.Both.Continue
{
	"\1â€¦â€¦å¥½éåˆ†ï¼å¥½éåˆ†å¥½éåˆ†ï¼ï¼%(you)ä¸€é»éƒ½ä¸è€ƒæ…®æˆ‘å€‘çš„æ„Ÿå—å—ï¼/
	\0\s[-1]\p[6]%(usernameHC)â€¦â€¦æˆ‘æ²’äº‹â€¦â€¦è«‹ä¸ç”¨â€¦â€¦æ“”å¿ƒâ€¦â€¦/
	\1\c**ç‚ºä»€éº¼éå¾—å¼„åˆ°é€™å€‹å¢ƒåœ°æ‰æ’¤é€€ï¼åæ­£æˆ‘å€‘æ˜¯ç¦é–‰è€…ï¼Œç—›ä¹Ÿæ²’é—œä¿‚å°å§ï¼/
	\p[2]\cä¸æ˜¯çš„â€¦â€¦/
	\0\s[-1]\p[6]\c%(usernameHC)ä»–ä¸æ˜¯æ•…æ„çš„â€¦â€¦\næˆ‘æ˜¯ç‚ºäº†%(usernameHC)èª•ç”Ÿçš„å·¥å…·ï¼Œå°±ç®—åš´é‡ææ¯€ä¹Ÿä¸è¦ç·Šï¼Œé‚„æœƒæœ‰ä¸‹ä¸€å€‹èµ«å¡è’‚å‡ºç¾ã€‚æ‚¨ä¸ç”¨é¡§æ…®æˆ‘ã€‚/
	\p[2]\cæˆ‘æ²’æœ‰é‚£æ¨£æƒ³â€¦â€¦/
	\1\cæˆ‘ä¸è¦ç†%(you)äº†å•¦ï¼ï¼åœ¨%(you)å¾¹åº•åçœä¹‹å¾Œï¼Œæˆ‘æ‰åŸè«’%(you)ï¼/
	\p[2]\cæŠ±æ­‰ï¼Œæµ·æ‹‰â€¦â€¦\e"
}


NextRound
{
	//åˆ¤å®šæ‡‰å¦å›å¾©ç¦é–‰è€…mp
	if roundNum%2 !=1
	{
		if Bmp[0]==Bmp[3]
		{//è‹¥èµ«èƒ½é‡å·²æ»¿ï¼Œå°‡å›å¾©å±€é•·èƒ½é‡
			if Bmp[2]<Bmp[4]
				Bmp[2]+=1
		}
		elseif Bmp[0]<Bmp[3]
			Bmp[0]++
		--
		if Bmp[1]==Bmp[3] && HLskill[1]<=0
		{//è‹¥æµ·èƒ½é‡å·²æ»¿ï¼Œå°‡å›å¾©å±€é•·èƒ½é‡
			if Bmp[2]<Bmp[4]
				Bmp[2]+=1
		}
		elseif Bmp[1]<Bmp[3] && HLskill[1]<=1
			Bmp[1]++
	}
	--
	roundNum+=1
	--
	DeleteBattleVar_Round
	ordertarget=1
	BattleWarning
}

//é€ƒè·‘
BattleRunaway
{
		"\c\0\s[-1]\1\s[-1]\p[2]%cp(3)\p[5]\f[align,center]\n[130]%BattleSurface('runaway')"
		--
		case ordertarget
		{	when 0 ; "\b[10]\n[-50]ç‚ºäº†%(usernameHC)çš„å®‰å…¨ï¼Œæˆ‘å€‘å¿«é»é›¢é–‹å§ã€‚"
			when 1 ; "\b[12]æˆ‘æ˜æ˜é‚„èƒ½æ‰“çš„ï¼"
		}
		--
		"\w9\w9\w9"
		--
		BattleMode=0
		DeleteAllBattleVar
		_mp=("Syndicate","ParmaRuins","RustRiver")
		_mn=(mapname,_mp)
		cum_battle_runaway[_mn]=TOINT(cum_battle_runaway[_mn]) ; cum_battle_runaway[_mn]++
		--
		"\p[5]\s[-1]\b[-1]\p[6]\s[-1]\b[32]\c%(bp) "
		--
		"å¾æˆ°é¬¥ä¸­é€ƒé›¢äº†â€¦â€¦ "
		"è‡³å°‘ï¼Œæ²’æœ‰è®“å¥¹å€‘å—é‡å‚·ã€‚"
		--
		"%(bp)\x"
		--
		"\0\s[0]\1\s[10]\p[2]%cp(0)\e"
}


AddWave
{
	if Bmp[2]<Bmp[4] ; Bmp[2]+=1
	if stamina<wave[2] && wave[0]<wave[1]+1
	{
		"\c\0\s[-1]\p[6]\n[130]\b[32]%(bp)é«”åŠ›ä¸è¶³ä»¥æ”¯æ’å¥¹å€‘ç¹¼çºŒå‰é€²ï¼Œè¦ä½¿ç”¨é“å…·è£œå……å—ï¼Ÿ%(bp)\n"
		--
		_txt=""
		for _i=0 ; consumable_name[_i]!="" ; _i++
		{
			if consumable[_i]>=1
			_txt+="\n[130]- \_q\__q[OnBattle.UseConsumable,%(_i)]%(consumable_name[_i])ï¼%(consumable_stamina[_i])\__q\_q"
		}
		_txt
		--
		if _txt=""
			"ï¼ˆæœªæŒæœ‰ä»»ä½•æ¢å¾©é“å…·ã€‚ï¼‰"
		--
		"\n[250]â†’\_q \__q[BattleRunaway][ å›åˆ°ç®¡ç†å±€ ]\__q\_q"
	}
	else
	{
		wave[0]+=1
		stamina-=wave[2]
		cum_stamina_use+=wave[2]
		--
		if wave[0]>=wave[1]+1
			MissionComplete
		elseif wave[0]==wave[1] && mapname=="DisSea"
			BossBattle
		else
			NextWave
	}
}
NextWave
{
	BattleMode=4
	DeleteBattleVar_Wave
	--
	"%BattleSurface('next')"
	--
	"\b[10]\c\![set,choicetimeout,0]\f[align,center]\n[111]%SFX('battle/01-HC-16-chief should we keep going')ç¹¼çºŒå‰é€²å—ï¼Ÿ%(usernameHC)ã€‚"
	"\b[10]\c\![set,choicetimeout,0]\f[align,center]\n[111]%SFX('battle/01-HC-58-battle still not end')æˆ°é¬¥é‚„æ²’çµæŸã€‚%(usernameHC)ã€‚"
	"\b[12]\c\![set,choicetimeout,0]\f[align,center]\n[111]%SFX('battle/HL-levelstrat-GOGOGO')GOï¼GOï¼GOï¼"
	"\b[12]\c\![set,choicetimeout,0]\f[align,center]\n[111]%SFX('battle/HL-levelstrat-GOGOGO')GOï¼GOï¼GOï¼"
	--
	"\p[6]\s[-1]\b[32]%(BattleInfoWindow)"
	--
	"\p[2]%cp(0)\b[20]\f[align,center]%(opp)\q[ç¹¼çºŒæ¢ç´¢,NewWave]\n[166]%(opp)\q[è¿”å›ç®¡ç†å±€,BattleRunaway]"
}
NewWave
{
	roundNum=1
	OrderDone=(0,0,0)
	enemy_nameSetting
	EnemyInfoSetting
	--
	BattleWarning
}

OnBattle.UseConsumable
{
	_a=reference0
	stamina+=consumable_stamina[_a]
	cum_stamina_heal[0]+=consumable_stamina[_a]
	cum_consumable[_a]=TOINT(cum_consumable[_a]) ; cum_consumable[_a]++
	consumable[_a]--
	--
	if stamina<wave[2]
		AddWave
	else
	{
		"\c\0\s[-1]\p[6]\n[130]\b[32]%(bp)å·²è£œå……äº†è¶³å¤ çš„é«”åŠ›ï¼Œå¯ä»¥ç¹¼çºŒåŸ·è¡Œä»»å‹™äº†ã€‚%(bp)"
		--
		"\x"
		--
		AddWave
	}
}





//Bossæˆ°(å…§æµ·å°ˆç”¨)
BossBattle
{
    case mapname
    {
        when "Syndicate"
			NewWave
        when ""
    }
	if mapname==Syndicate
		{enemy_name=ANY(EnemyC)
		BattleWarning}
	elseif mapname==RustRiver
}




//åœ°åœ–é€šé—œ
MissionComplete
{
    _a=ASEARCH(mapname,map_name_en)
	cum_battle_complete[_a]=TOINT(cum_battle_complete[_a]) ; cum_battle_complete[_a]++
	discoin+=missionpay
	cum_gain_discoin[0]+=missionpay
	intimacy+=10
	cum_int_HC[2]=TOINT(cum_int_HC[2]) ; cum_int_HC[2]+=10
	cum_int_HL[2]=TOINT(cum_int_HL[2]) ; cum_int_HL[2]+=10
	mood+=30
	BattleMode=5
    --
	MissionComplete_MSG
}
MissionComplete_MSG
{	
	"\0\s[-1]\p[6]\s[-1]\p[3]\s[310000]\b[0]è¾›è‹¦äº†ï¼Œ\w5%(username)ã€‚\w7\næœ¬æ¬¡ä»»å‹™çš„å®Œæˆå ±é…¬%(missionpay)ç‹„æ–¯å¹£ï¼Œ\w7å·²ç¶“åŒ¯é€²æ‚¨çš„å¸³æˆ¶äº†ã€‚\w6/
	\p[2]%cp(0)\b[20]\f[align,center]\q[ å†æ¬¡æˆ°é¬¥ ,BattleAgain]\n[166]\q[ å›åˆ°ç®¡ç†å±€ ,GobackBureau]"
}
BattleAgain
{
	"\p[3]\s[310000]\b[0]\cå¥½çš„ï¼Œ\w4è«‹%(username)åˆ‡å‹¿å‹‰å¼·è‡ªå·±ã€‚\w9\w9\p[3]\s[-1]"
	--
	DeleteAllBattleVar
	BattleMode=10
	--
	BattleMapChoose_Line
}
GobackBureau
{
	BattleMode=0
	DeleteAllBattleVar
	--
	"\p[3]\s[310002]\b[0]\cè«‹æ‚¨å¥½å¥½ä¼‘æ¯ï¼Œ\w5%(username)ã€‚\x\p[5]\s[-1]\p[3]\s[-1]\0\s[0]\1\s[10]\e"
}





//====================================================
//-------------------åˆªé™¤æˆ°é¬¥ç”¨è®Šæ•¸-------------------
//====================================================
DeleteBattleVar_Skill
{
	HCskill-- ; HLskill--
	for _i=0 ; _i<3 ; _i++
	{	if HCskill[_i]<0 ; HCskill[_i]=0
		if HLskill[_i]<0 ; HLskill[_i]=0
	}
	HCskill[0]=0
	HLskill[0]=0
}
DeleteBattleVar_Round
{
	def=(1,1)
	OrderDone=(0,0,0)
	attack_target=0
	debuff_HC-- ; debuff_HL--
	for _i=0 ; _i<ARRAYSIZE(debuff_name) ; _i++
	{
		if debuff_HC[_i]<0 ; debuff_HC[_i]=0
	}
	for _i=0 ; _i<ARRAYSIZE(debuff_name) ; _i++
	{
		if debuff_HL[_i]<0 ; debuff_HL[_i]=0
	}
	DeleteBattleVar_Skill
	ERASEVAR('OrderEffectMode')
	enemy_action="idle"
}
DeleteBattleVar_Wave
{
	DeleteBattleVar_Round
	ERASEVAR('enemy_name')
	ERASEVAR('Einc')
	ERASEVAR('Ehp')
	ERASEVAR('Edrop')
	Edrop[5]=""
	Edrop[6]=""
	Edrop[7]=0
	pressbutton=0
}
DeleteBattleVar_Map
{
	ERASEVAR('mapname')
	ERASEVAR('hp')
	ERASEVAR('Bmp')
	ERASEVAR('Edmg')
	ERASEVAR('missionpay')
}
DeleteAllBattleVar
{
	DeleteBattleVar_Round
	DeleteBattleVar_Wave
	DeleteBattleVar_Map
	BattleMode=0
	--
	"\![sound,stop]\p[5]\![bind,enemy,none,1]\![bind,background,none,1]\s[-1]\0\s[1]\1\s[10]\p[2]%cp(0)"
}

//====================================================
////////////////////////æˆ°é¬¥ç•«é¢//////////////////////
//====================================================
BattleSurface
{
	_screen=_argv[0]
	--
	_txt="" //\0\s[-1]\1\s[-1]
	_txt+="\p[5]\s[5200"
	--
	if _screen=='next'			//-----ä¸‹å›åˆ
	{	_txt+="5"
		if hp[0]>0 && hp[1]>0
			_txt+="%ANY(0,1)"
		elseif hp[0]==0
			_txt+="2"
		elseif hp[1]==0
			_txt+="3"
	}
	elseif _screen=='runaway'	//-----é€ƒèµ°
	{	_txt+="9"
		--
		if hp[0]>0 && hp[1]>0
		{	if ordertarget==0 ; _txt+="0"
			else ; _txt+="1"
		}
		elseif hp[0]==0
			_txt+="2"
		elseif hp[1]==0
			_txt+="3"
	}
	else						//-----æˆ°é¬¥ä¸­
	{	
		if hp[0]>0 && hp[1]>0
			_txt+="1"
		elseif hp[0]==0
			_txt+="2"
		elseif hp[1]==0
			_txt+="3"
		--
		_a=0 ; _c=0
		if ordertarget==1 || enemy_action=="hella" || attack_target==1
			_a=1
		if enemy_action=="hecate" ; _a=0
		_b=_a*3
		case _screen
		{
			when 'idle'			; _c=0
			when 'atk'			; _c=1+_b
			when 'skill'		; _c=2+_b
			when 'hurt'			; _c=3+_b
			when 'taunt'		; _c=7
			when 'aoe'			; _c=8
			when 'dreamshadow'  ; _c=9
		}
		if _argv[0]=='hurt' && enemy_action=="aoe" ; _c=8
		_txt+="%(_c)"
		
	}
	--
	_txt+="]\![bind,enemy,%(enemy_name)-"
	--
	case _screen
	{
		when 'idle','atk','skill','taunt' ; _txt+="idle"
		other ; _txt+=enemy_action
	}
	--
	_txt+=",1]"
	--
	case _screen
	{	when 'next','runaway','none' ; _txt+="\![bind,enemy,none,1]"
	}
	--
	_txt
	
}
//battlescreen[0å¾…æ©Ÿ,1èµ«æ”»æ“Š,2æŠ€èƒ½,3æ•µæ–¹æ”»æ“Š(èµ«),4æµ·æ”»æ“Š,5æµ·æŠ€èƒ½,6æ•µæ–¹æ”»æ“Š(æµ·),7æµ·å˜²è«·,8æ•µæ–¹æ”»æ“Š(å…¨é«”),9å¤¢é­˜æ‰¿å‚·,50èµ«ä¸‹å›åˆ,51æµ·ä¸‹å›åˆ,90èµ«é€ƒèµ°,91æµ·é€ƒèµ°,100ç©ºåœ°)]

BattleScreenSetting
{
	_action=_argv[0]
	--
	_txt="\0\s[-1]\1\s[-1]\p[5]\s[5200"
	if _action<10
	{
		if incapacitated[0]==1
			_txt+="2"
		elseif incapacitated[1]==1
			_txt+="3"
		else
			_txt+="1"
		--
		_txt+="%(_action)"
	}
	elseif _action<100
		_txt+=_action
	else
		_txt+="10"
	_txt+="]"
	--
	_txt+="\![bind,enemy,"
	if _action>=50
		_txt+="none"
	elseif _action ==3 || _action ==7 || _action ==8
	{	_txt+=enemy_name
		_txt+="-"
		_txt+=enemy_action	}
	else
		_txt+=enemy_name+"-idle"
	--
	_txt+=",1]"
	--
	_txt
}

//====================================================
////////////////////////æ•¸å€¼è¨­å®š//////////////////////
//====================================================
//åˆæ¬¡æˆ°é¬¥(è¨­å®šèµ«å¡è’‚æ•¸å€¼)
FristBattleInfoSetting
{
	if level==1
		HCinc=(500,317)
	elseif level>1
		{HCinc_b=(500+(level-1)*10,317+(level-1)*3+TOINT(ROUND((level-1)/7*5)))
		HCinc=(HCinc_b[0]+HCinc_ex[0],HCinc_b[1]+HCinc_ex[1])}
	elseif level>=100
		{HCinc_b=(50000,18703)
		HCinc=(HCinc_b[0]+HCinc_ex[0],HCinc_b[1]+HCinc_ex[1])}
}
//å…¶ä»–æˆ°é¬¥
BattleInfoSetting
{
	InitialSetting
	hp[0]=(HCinc[0],HCinc[1])
	DSinc_l=(DSinc[0],DSinc[1])
}

//å€‹åˆ¥æ•µäººæ•¸å€¼è¨­å®š
EnemyInfoSetting
{
	case mapname
	{
	  when "Syndicate"
		Einc=Einc_C
	  when "ParmaRuins"
		Einc=(TOINT(Einc_C[0]*3.712),TOINT(Einc_C[1]*1.5))
	  when "RustRiver"
		Einc=(TOINT(Einc_C[0]*2.2),Einc_C[1]*2.2)
	}
	--
	//æ±™æŸ“åŠ æˆ
	_hp=TOINT(level*20*level*0.14856)
	_atk=TOINT(_hp*0.4)
	Einc=(TOINT(Einc[0]+Einc[0]*batlle_level*batlle_level*0.3141592)+RAND(_hp),TOINT(Einc[1]+Einc[1]*batlle_level*batlle_level*0.2077)+RAND(_atk))
	--
	if enemy_name=="å¯¦é©—äººå“¡"
		Einc[0]=10
	if enemy_name=="ï¼Ÿï¼Ÿï¼Ÿ"
		Einc[0]=TOINT(Einc[0]*10.7777)
	--
	Ehp=Einc[0]
}


//====================================================
////////////////////////é“å…·å¼·åŒ–//////////////////////
//====================================================
//æ”»æ“ŠåŠ›å¼·åŒ–
EatHowManyPAFE
{
	"\0\s[-1]\p[6]è¦ç”¨å¹¾å€‹ï¼Ÿ\![open,inputbox,OnEatPAFE]"
}
OnEatPAFE
{
	if reference0==0
		"\0\s[-1]\p[6]â€¦â€¦ä¸å¼·åŒ–äº†å—ï¼Ÿ"
	elseif TOINT(FLOOR(reference0))==0
		"\0\s[-1]\p[6]é€™ä¸¦éä¸€å€‹æ•¸ç›®ï¼Œ%(usernameHC)å£èª¤äº†å—ï¼Ÿ\![open,inputbox,OnEatPAFE]"
	elseif PAFE<(TOINT(FLOOR(reference0)))
		{"\0\s[-1]\p[6]æ‚¨ä¸¦æ²’æœ‰é‚£éº¼å¤šçš„ç•°èƒ½æºç´ å“¦ï¼Œ\n/
		ç›®å‰åªæœ‰%(PAFE)å€‹ã€‚\![open,inputbox,OnEatPAFE]"}
	elseif reference0>=1
		{"\c\0\s[-1]\p[6]"
		--
		"è¬è¬ï¼Œæˆ‘â€¦â€¦ä¸€å®šä¸æœƒè¾œè² æ‚¨çš„æœŸæœ›ã€‚\n[130]"
		"å¦‚æ­¤ä¸€ä¾†ï¼Œæˆ‘åˆæœ‰æ›´å¼·å¤§çš„åŠ›é‡å¯ä»¥ä¿è­·%(you)äº†ã€‚\n[130]"
		--
		"\w7"
		--
		OnPAFEupATK}
	else
		{"\0\s[-1]\p[6]å’¦ï¼Ÿå¥½åƒç™¼ç”Ÿäº†ä»€éº¼éŒ¯èª¤â€¦â€¦ï¼Ÿ"
		"\0\s[-1]\p[6]ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ï¼Œè«‹%(usernameHC)é‡æ–°æ“ä½œä¸€æ¬¡ã€‚"
		--
		PAFEinfo}
}
OnPAFEupATK
{
	_atkup=reference0*level
	HCinc_ex[1]+=_atkup
	PAFE-=reference0
	--
	"\f[height,12]\f[color,#B8C7CC]ï¼ˆå·²ä½¿ç”¨%(reference0)å€‹ç•°èƒ½æºç´ æå‡\f[color,#EA0000]\f[bold,1]%(_atkup)\f[bold,0]\f[color,#B8C7CC]é»æ”»æ“ŠåŠ›ã€‚ï¼‰\x\c"
	--
	PAFEinfo
}






